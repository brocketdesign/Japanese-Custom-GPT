<!DOCTYPE html>
<html lang="ja">
    {{> dashboard-header}}
<body>

    <style>
        .scroll-horizontal {
            flex-wrap: nowrap;
            width: 100%;
            flex-direction: row;
            overflow-x: scroll;
        }
        .u-color-grad {
            background: linear-gradient(90.9deg, rgba(110, 32, 244, 0.5) 2.74%, #6E20F4 102.92%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-right: 6px;
            letter-spacing: 0;
            font-size: 54px;
            line-height: 1;
        }
        .onchat-off, .onchat-on{
            display: none;
        }
        .avatar{
            object-fit: cover;
            object-position: top;
            width: 32px;
        }
        .card-img-top.girls_avatar {
            object-fit: cover;
            object-position: top;
            width: 100%;  
            margin: auto;
            border-radius: 15px;
            height: 300px;
            padding: 0 5px;  
            background-position: top;
            background-size: cover;
        }
        .scroll-container {
        display: flex;
        flex-wrap: nowrap;
        overflow-x: auto;
        }
        .scroll-container > * {
        flex: 0 0 auto;
        width: auto;
        }
        .category-container {
            display: flex;
            overflow-x: auto;
            white-space: nowrap;
        }
        .category-button {
            margin: 5px;
        }
        .card-round-design .col-12{
            margin-top: 50px;
        }
        .card-round-design .col-12 .card .card-img-top{
            position: absolute;
            top: -50px;
            width: 100px;
            height: 100px;
            left: 0;
            right: 0;
            margin: auto;
            border-radius: 150px;
            object-fit: cover;
            object-position: top;
        }
        .card-round-design .col-12 .card .card-body{
            padding-top: 100px;
        }
        .card-round-design .col-10 .card .card-img-top{
            height: 270px;
            margin: auto;
            object-fit: cover;
            object-position: top;
        }

        .chat-container {
            display: flex;
            overflow-x: auto;
            padding-bottom: 10px;
        }
        .chat-card {
            flex: 0 0 auto;
            width: 30vw;
            margin-right: 15px;
        }
        .online-text {
            width: 95%; /* Adjust the width as needed */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .chat-container .card:hover {
            background: #eee !important;
        }
        @media (max-width: 600px) {
            .card-img-top.girls_avatar {
                height: 200px;
            }
            .noscroll{
                display: block;
                overflow: hidden;
                height: 80vh !important;
            }
            .top-img{
                width: 70%;
            }
            .card.chat-card {
                width: 330px;
            }
        }
        .intro-thumbnail{
            border-radius: 150px;
            margin-bottom: 10px;
            width: 100px;
            object-fit: cover;
            height: 100px;
            object-position: top;
        }
        .sidebar, .sidebar-history {
            height: 100vh;
            width: 260px;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1034;
            background-color: #f5f5f5;
            transition: transform 0.3s ease;
            transform: translateX(0);
            overflow: scroll;
            padding-top: 0.75em;
        }
        .sidebar.hidden ,.sidebar-history.hidden {
            transform: translateX(-260px);
        }
        .sidebar-history.shadow {
            z-index: 1035;
        }
        .content {
            margin-left: 260px;
            transition: margin-left 0.3s ease;
        }
        .content.collapsed {
            margin-left: 0;
        }
        nav.navbar {
            margin-left: 0;
            transition: margin-left 0.3s ease;
        }
        nav.navbar.move {
            margin-left: 260px;
        }
        .choice-container {
            text-wrap: nowrap;
            overflow: auto;
            padding: 15px 0px;
        }
        #startButton {
            border-radius: 50px;
            font-weight: bold;
        }
        #chatContainer {
            height: 100%;
            overflow-y: scroll;
        }
        #chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }
        .card-header, .card-footer {
            flex-shrink: 0;
        }
        .card-body {
            flex-grow: 1;
            overflow-y: auto;
            position: relative;
        }
        .btn-flat-border {
            display: inline-block;
            padding: 0.3em 1em;
            text-decoration: none;
            color: #742af4;
            border: solid 2px #b58df9;
            border-radius: 3px;
            transition: .4s;
            margin-right: 5px;
            margin-left: 5px;
            font-size: 18px;;
        }
        .dropdown-toggle::after {
            display:none !important;
        }

        .btn-flat-border:hover {
            background: #742af4;
            color: white;
        }
        #messages {
            padding: 10px;
            padding-bottom: 100px;
            border-radius: 5px;
            z-index: 1;
        }
        #chatInput {
            position: absolute;
            bottom: 0;
            width: 100%;
            right: 0;
            left: 0;
            background: white;
            z-index: 1000;
            padding: 10px;
        }
        #sendMessage,
        #chatInput .load {
            border-left: 0 !important;
            border-radius: 0px 30px 30px 0px !important;
            box-shadow: none;
        }
        #userMessage {
            border-radius: 30px 0px 0px 30px !important;
            background-color: #f5f5f5;
            height: 60px;
            font-size: 14px;
            padding-left: 20px;
            resize: none;
        }
        #userMessage:focus {
            outline: none;
            box-shadow: none; /* If there is a box shadow applied on focus */
        }
        .user-chat{
            cursor: pointer;
        }
        .user-chat:hover{
            background-color: #f8f9fa;
        }

        .chat-list .thumb {
            margin-right: 0px;
        }
        .chat-list .thumb img {
            width: 40px;
            height: 40px;
            -o-object-fit: cover;
            object-fit: cover;
            overflow: hidden;
            object-position: top;
            border-radius: 50%;
        }
        .chat-list.item:hover, .user-chat-history:hover {
            background-color: #c6c9cc99 !important;
        }
        .chat-list .dropdown .dropdown-toggle{
            transform: rotate(90deg);
        }
        .chat-list .dropdown .dropdown-toggle{
            opacity: 0;
            pointer-events: 'none';
        }
        .online-text {
            width: 150px; 
            white-space: nowrap;
            overflow: hidden;
        }
        .lines-paragraph {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;  
            overflow: hidden;
        }

        .chat-contain .card-body{
                width: 100%;
        }
        .swal-image{
            border-radius: 50px;
            object-fit: cover;
        }

        @media (max-width: 600px) {
            .chat-contain .card-body{
                width: 100%;
            }
            .content,
            nav.navbar.move {
                margin-left: 0px;
            }
        }
    </style>
    
    <div class="sidebar-history hidden shadow">
        <h5 class="my-2 mx-3">チャット履歴</h5>
        <div id="chat-history"></div>
    </div>
    <div class="sidebar hidden bg-light shadow-0">
        <!-- Avatar -->
        <div class="nav-item dropdown d-inline-block d-sm-none">
            <a data-mdb-dropdown-init class="nav-link dropdown-toggle hidden-arrow d-flex align-items-center" href="#"
                id="navbarDropdownMenuLink" role="button" aria-expanded="false">
                <img src="{{#if user.profileUrl}}{{user.profileUrl}}{{else}}/img/avatar.png{{/if}}" 
                class="rounded-circle avatar" height="32" alt="Avatar"
                loading="lazy" />
            </a>
            <ul class="dropdown-menu dropdown-menu-end mx-3" aria-labelledby="navbarDropdownMenuLink">
                {{#if user.isTemporary}}
                    <li><a class="dropdown-item" href="/authenticate">ログイン</a></li>
                {{else}}
                    <li><a class="dropdown-item" href="/settings">設定</a></li>
                    <li><a class="dropdown-item logout" href="#">ログアウト</a></li>
                {{/if}}
            </ul>
        </div>
        <div class="tools d-flex align-items-center">
            <div class="d-none w-100 m-2">
                <button class="menu-chat-sm d-sm-none btn bg-white shadow-0"><i class="fa-solid fa-bars"></i></button>
            </div>
            <div>
                <a href="/chat/edit/" class="m-2 btn px-4 py-2 border shadow-0 btn-outline-secondary" style="border-radius:40px;">
                    <i class="fas fa-plus me-2"></i>作成する
                </a>
                <span onclick="showDiscovery()" class="m-2 btn px-4 py-2 border shadow-0 btn-outline-secondary " style="border-radius:40px;">
                    <i class="fas fa-compass me-2"></i>ライブラリー
                </span>
            </div>
        </div>
        <div class="mt-3" style="height: 70vh;overflow-y: scroll;overflow-x: hidden;padding-bottom:100px">
            {{#each chats}}
            <div class="chat-list item user-chat d-flex align-items-center justify-content-between px-0 py-1 bg-transparent" style="cursor: pointer;" 
            data-id="{{this._id}}" data-userid="{{this.userId}}" >
                <div class="d-flex align-items-center w-100">
                    <div class="user-chat-content" style="flex: 1;display: flex;align-items: center;">
                        <div class="thumb align-items-center text-center justify-content-center d-flex flex-column col-3 p-1" >
                            <img class="img-fluid" src="{{#if this.thumbnailUrl}}{{this.thumbnailUrl}}{{else if this.chatImageUrl}}{{this.chatImageUrl}}{{else}}/img/logo.webp{{/if}}" alt="">
                        </div>
                        <div class="chat-list-details">
                            <div class="chat-list-info">
                                <div class="chat-list-title">
                                    <h6 class="mb-0 online-text" style="font-size: 14px;">{{this.name}}</h6>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="d-flex align-items-center">
                        <!-- Dropdown -->
                        <div class="dropdown pe-3">
                            <button class="btn border-0 shadow-0 dropdown-toggle ms-2 " type="button" id="dropdownMenuButton_{{this._id}}" data-mdb-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end shadow rounded" aria-labelledby="dropdownMenuButton_{{this._id}}">
                                <li>
                                    <button class="dropdown-item chart-button" data-id="{{this._id}}">
                                        <i class="fas fa-chart-line"></i> 分析
                                    </button>
                                </li>
                                <li>
                                    <button class="dropdown-item tag-button" data-id="{{this._id}}">
                                        <i class="fas fa-share"></i> 共有
                                    </button>
                                </li>
                                <li>
                                    <a href="/chat/edit/{{this._id}}" class="dropdown-item">
                                        <i class="far fa-edit"></i> 編集
                                    </a>
                                </li>
                                <li>
                                    <span data-id="{{this._id}}" class="dropdown-item delete-chat" style="cursor:pointer">
                                        <i class="fas fa-trash"></i> 削除
                                    </span>
                                </li>
                            </ul>
                        </div>
                        <!-- End of Dropdown -->
                    </div>
                </div>
            </div>
            {{/each}}
        </div>
    </div>
    <div id="overlay" class="d-sm-none bg-dark position-absolute" style="inset:0;z-index:1033;display:none;opacity: 0.4;overflow:hidden"></div>
    <div class="content collapsed">
        <nav class="navbar navbar-expand-lg navbar-white bg-white fixed-top shadow-0">
            <div class="container-fluid">
                <div class="d-flex align-items-center justify-content-center m-auto">
                    <div style="position: absolute;left: 20px;top: 10px;">

                        <button class="menu-chat-sm d-sm-none btn btn-light"><i class="fa-solid fa-bars"></i></button>
                        <button id="menu-chat" class="d-none d-sm-inline-block btn btn-light"><i class="fa-solid fa-bars"></i></button>

                        <button id="history-chat" class="btn btn-light onchat-on"><i class="fas fa-history"></i></button>
                        <div class="d-none d-sm-inline-block">
                            <button class="btn btn-light reset-chat onchat-on" data-toggle="tooltip" title="新しいチャット" data-original-title="New">
                                <i class="fas fa-plus-circle"></i>
                            </button>
                        </div>
                        <!-- Dropdown -->
                        <div class="d-none d-sm-inline-block">
                            <div class="dropdown onchat-on">
                                <button class=" btn btn-light dropdown-toggle" type="button" id="dropdownMenuButton_{{chatId}}" data-mdb-toggle="dropdown" aria-expanded="false">
                                    <i class="fas fa-ellipsis-v"></i>
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton_{{chatId}}">
                                    <li>
                                        <button class="dropdown-item chart-button" data-id="{{chatId}}">
                                            <i class="fas fa-chart-line"></i> 分析
                                        </button>
                                    </li>
                                    <li>
                                        <button class="dropdown-item tag-button" data-id="{{chatId}}">
                                            <i class="fas fa-share"></i> 共有
                                        </button>
                                    </li>
                                    <li>
                                        <a href="/chat/edit/{{chatId}}" class="dropdown-item edit-chat">
                                            <i class="far fa-edit"></i> 編集
                                        </a>
                                    </li>
                                    <li>
                                        <span data-id="{{chatId}}" class="dropdown-item delete-chat" style="cursor:pointer">
                                            <i class="fas fa-trash"></i> 削除
                                        </span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <!-- End of Dropdown -->
                    </div>
                    <div class="d-flex flex-row" style="cursor:pointer" onclick="showDiscovery()">
                        <img src="/img/logo.webp" alt="" class="mx-3" width="40px">
                        <span class="d-none">LAMIXボット</span>
                    </div>       
                    
                </div>
                <div>
                    <div class="navbar-collapse" id="navbarNav">
                        <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                            <li class="nav-item d-inline-block d-sm-none">
                                <button class="btn btn-light reset-chat onchat-on" data-toggle="tooltip" title="新しいチャット" data-original-title="New">
                                    <i class="fas fa-plus-circle"></i>
                                </button>
                            </li>
                            <!-- Avatar -->
                            <li class="nav-item dropdown d-none d-sm-inline-block ">
                                <a data-mdb-dropdown-init class="nav-link dropdown-toggle hidden-arrow d-flex align-items-center" href="#"
                                    id="navbarDropdownMenuLink" role="button" aria-expanded="false">
                                    <img src="{{#if user.profileUrl}}{{user.profileUrl}}{{else}}/img/avatar.png{{/if}}" 
                                    class="rounded-circle avatar" height="32" alt="Avatar"
                                    loading="lazy" />
                                </a>
                                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownMenuLink">
                                    {{#if user.isTemporary}}
                                        <li><a class="dropdown-item" href="/authenticate">ログイン</a></li>
                                    {{else}}
                                        <li><a class="dropdown-item" href="/settings">設定</a></li>
                                        <li><a class="dropdown-item logout" href="#">ログアウト</a></li>
                                    {{/if}}
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </nav>
        <section id="chat-discovery" class="onchat-off py-5">
            <div class="my-5">
                    <section class="w-100 px-3 py-2">
                        <img src="/img/logo.webp" alt="" class="mx-3 mb-3" width="75px">
                        <span class="u-font-manrope u-color-grad">Lamix</span>は、
                        <h3 class="fw-bold mb-3">AIキャラクターと友達になって楽しくおしゃべりができるAIチャットアプリです。</h3>
                        <h5>好きなキャラクターとおしゃべりしよう！</h5>
                        <p>お気に入りのキャラクターを選んで楽しい会話を楽しめます。最新のAI技術でキャラクターが生き生きとし、まるで本物の友達と話しているかのような体験ができます。さらに、キャラクターを自分好みにカスタマイズしたり、ゼロから新しいキャラクターを作成することも可能です。新しい友達を作って、自由におしゃべりを楽しんでください！</p>
                    </section>
                    <div class="border border-light mt-4 mb-5"></div>
                {{#if peopleChats}}
                    <section class="w-100 px-0 py-2">
                        <div id="category-container" class="category-container mb-3"></div>
                        <h4 class="mb-4">みんなのチャット</h4>
                        <div class="chat-container">
                            {{#each peopleChats}}
                            <div class="card chat-card flex-row bg-light border border-secondary shadow-0" style="border-radius: 20px; cursor:pointer" onclick="redirectToChat('{{this._id}}')">
                                <div style="min-width:100px;width: 300px; height: auto; display: flex; justify-content: center; align-items: center;">
                                    <img src="{{this.thumbnailUrl}}" class="img-fluid m-3" alt="Thumbnail" onerror="this.src='/img/logo.webp';" style="width: 50px; height: 50px; object-fit: cover;border-radius: 50px;">
                                </div>
                                <div class="card-body">
                                    <h6 class="card-title fw-bold text-start">{{this.name}}</h6>
                                    <p class="card-text lines-paragraph">{{this.description}}</p>
                                    <p class="text-muted d-none"><i class="fas fa-clock"></i> 更新: <span class="date-time">{{this.dateStrJP}}</span></p>
                                </div>
                            </div>
                            {{/each}}
                    </div>
                    </section>
                {{/if}}
                <section class="w-100 p-0">
                    <h4 class="px-4">まずはこの子達から始めよう🌟</h4>
                    <div id="cardGrid-2" class="row py-3 px-3 scroll-horizontal"></div>
                </section>
                <section class="w-100 p-0">
                    <h4 class="px-4">今一人? シゲキテキな世界へようこそ‼︎</h4>
                    <div id="custom-card-container" class="row py-3 px-3 scroll-horizontal"></div>
                </section>
                <section class="w-100 p-0">
                    <h4 class="px-4">知識を探る冒険へ！専門家とチャットしよう！</h4>
                    <div id="chatbot-container" class="row py-3 px-3 scroll-horizontal"></div>
                </section>
                <section class="w-100 p-0">
                    <h4 class="px-4">Lamixが厳選したキャラクター</h4>
                    <div id="cardGrid" class="row py-3 px-3 scroll-horizontal"></div>
                </section>
                <section class="w-100 p-0 d-none">
                    <h4 class="px-4">ニーズに合ったチャットを作成する</h4>
                    <div class="scroll-container d-flex justify-content-between  py-4" id="button-container"></div>
                </section>
                <section>
                    <div class="text-center m-5">
                        <h3>キャラクターを作成する</h3>
                        <p>どのキャラクターとも相性がよくありませんか? 自分だけのキャラクターを作成しましょう! 会話の構成や口調などをカスタマイズできます!</p>
                        <a href="/chat/edit/" class="m-2 px-5 py-2 btn btn-large border shadow-0 btn-dark" style="border-radius:40px;font-size: 21px;">
                            <i class="fas fa-plus me-2"></i>作成する
                        </a>
                    </div>
                </section>
            </div>
        </section>
        <div class="container chat-contain px-0 onchat-on">
            <div id="chat-container" class="card shadow-0 rounded-0"></div>
                <div class="card-body text-center py-0 container" style="min-height:250px;overflow-y:hidden;">
                    <div id="chatContainer" class="pt-2" style="padding-top: 100px !important;;padding-bottom: 100px !important;"></div>
                    <div id="chatInput" class="input-group rounded-0 rounded-bottom bg-white" style="position: absolute;bottom: 0;left: 0;right: 0;padding: 0px 15px 5px 15px;">
                        <div id="input-container" class="d-flex w-100">
                            <textarea id="userMessage" class="form-control py-3 border-0" placeholder="チャットしよう"></textarea>
                            <button id="sendMessage" class="btn btn-light px-4 border-0"><i class="fas fa-paper-plane"></i></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>  
    </div>

 {{> dashboard-footer}}
<script src="/js/discovery.js"></script>
<script src="/js/chat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js"></script>
<script>
$(document).ready(function() {
    function adjustHeight() {
        const newHeight = $(window).height() * 0.97;
        $('.chat-contain .card-body').height(newHeight);
    }

    // Adjust height on document ready
    $(document).ready(adjustHeight);

    // Adjust height on window resize
    $(window).resize(adjustHeight);

    // Initialize user preference from cookie
    if (Cookies.get('sidebarState') === 'expanded') {
        $('.sidebar').removeClass('hidden');
        $('.content').removeClass('collapsed');
        $('nav.navbar').addClass('move');
        $('#overlay').show()
    }
    $('#menu-chat').on('click', function(){

        $('.sidebar-history').addClass('hidden');
        const sidebar = $('.sidebar');
        const content = $('.content');
        const navbar = $('nav.navbar');
        
        if (sidebar.hasClass('hidden')) {
            sidebar.removeClass('hidden');
            content.removeClass('collapsed');
            navbar.addClass('move');
            $('#overlay').show()
        } else {
            sidebar.addClass('hidden');
            content.addClass('collapsed');
            navbar.removeClass('move');
            $('#overlay').hide()
        }
        
        // Update the cookie based on the new state
        if ($('.sidebar').hasClass('hidden')) {
            Cookies.set('sidebarState', 'collapsed', { expires: 7 }); // Cookie expires in 7 days
        } else {
            Cookies.set('sidebarState', 'expanded', { expires: 7 });
        }
    });
    $('#history-chat').on('click', function(){
        $('.sidebar-history').toggleClass('hidden');
        $('.sidebar').removeClass('hidden');
        $('.content').removeClass('collapsed');
        $('nav.navbar').addClass('move');
        $('#overlay').toggle()
        $('.content').toggleClass('noscroll');
    })
    $('.menu-chat-sm').on('click', function(){
        $('.sidebar').toggleClass('hidden');
        $('#overlay').toggle()
        $('.content').toggleClass('noscroll');
    });
    $('#overlay').on('click', function(){
        $('#overlay').toggle()
        $('.sidebar').toggleClass('hidden');
        $('.sidebar-history').addClass('hidden');
        $('.content').toggleClass('noscroll');
        // Update the cookie based on the new state
        if ($('.sidebar').hasClass('hidden')) {
            Cookies.set('sidebarState', 'collapsed', { expires: 7 }); // Cookie expires in 7 days
        } else {
            Cookies.set('sidebarState', 'expanded', { expires: 7 });
        }
    });
    
    $('.chart-button').on('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        // data-id属性からチャットIDを取得
        var chatId = $(this).data('id');

        // POSTリクエストを送信
        $.post('/api/chat-analyze/', { chatId: chatId })
            .done(function(response) {
                // 受け取ったデータの長さを取得
                var dataLength = response.total;

                // SweetAlert2でアラートを表示
                Swal.fire({
                    html: `
                        <div class="card border-0">
                            <div class="card-body">
                                <h5 class="card-title">${response.chat.name}</h5>
                                <p class="card-text text-muted" style="font-size: 16px;">${response.chat.description}</p>
                                <p class="card-text text-muted d-none" style="font-size: 14px;">作成者: ${response.author}</p>
                                <div class="d-flex justify-content-between mb-3">
                                    <div class="card-text text-center d-flex w-100 d-none" style="flex-direction: column;"><span class="w-100">${response.chat.rating ? response.chat.rating : '...'}</span><span class="text-muted" style="font-size: 12px;">評価</span></div>
                                    <div class="card-text text-center d-flex w-100" style="flex-direction: column;" ><span class="w-100">${response.chat.category ? response.chat.category : '...'}</span><span class="text-muted" style="font-size: 12px;">カテゴリー</span></div>
                                    <div class="card-text text-center d-flex w-100" style="flex-direction: column;" ><span class="w-100">${response.total ? response.total : '0'}</span><span class="text-muted" style="font-size: 12px;">会話の合計</span></div>
                                </div>
                                <a href="/chat/${response.chat._id}" class="btn btn-dark w-100 my-4" style="border-radius:50px;">チャットを始める</a>
                            </div>
                        </div>
                    `,
                    imageUrl: response.chat.thumbnailUrl || '/img/logo.webp',
                    imageWidth: 100,
                    imageHeight: 100,
                    imageAlt: 'Thumbnail',
                    showCloseButton: true,
                    showConfirmButton: false,
                    customClass: {
                        image: 'swal-image'
                    }
                });
            })
            .fail(function() {
                // エラーハンドリング
                Swal.fire({
                    title: 'エラー',
                    text: 'データの取得に失敗しました。',
                    icon: 'error'
                });
            });
    });
    $('.tag-button').click(function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        var dataId = $(this).attr('data-id');
        var codeToCopy = `<div id="lamix-chat-widget" data-id="${dataId}"></div><script src="https://lamix.hatoltd.com/js/chat-widget.js"></` + `script>`;

        // Create a temporary textarea element to copy the text
        var $temp = $('<textarea>');
        $('body').append($temp);
        $temp.val(codeToCopy).select();
        document.execCommand('copy');
        $temp.remove();

        // Show SweetAlert2 notification
        Swal.fire({
            title: 'コピー完了',
            text: 'タグをコピーしました。チャットボットを設置したい場所にタグを貼り付けてください。',
            icon: 'success',
            confirmButtonText: 'OK'
        });
    });
    $('.delete-chat').on('click', function(e) {
        e.preventDefault()
        e.stopPropagation();
        const chatId = $(this).data('id');
        const userId = $(this).data('userid');
        Swal.fire({
            title: '本当に削除しますか？',
            text: "この操作は元に戻せません！",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'はい、削除します！',
            cancelButtonText: 'キャンセル'
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    url: `/api/delete-chat/${chatId}`,
                    type: 'DELETE',
                    data: { userId },
                    success: function(response) {
                        $(`.chat-list[data-id="${chatId}"]`).fadeOut().remove();
                    },
                    error: function(xhr, status, error) {
                        Swal.fire(
                            'エラー',
                            'チャットの削除に失敗しました。',
                            'error'
                        );
                    }
                });
            }
        });
    });
    $(document).on('click', '.delete-chat-history', function(e) {
        e.preventDefault()
        e.stopPropagation();
        const selectedChatId = $(this).data('id');
        Swal.fire({
            title: '本当に削除しますか？',
            text: "この操作は元に戻せません！",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'はい、削除します！',
            cancelButtonText: 'キャンセル'
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    url: `/api/delete-chat-history/${selectedChatId}`,
                    type: 'DELETE',
                    success: function(response) {
                        console.log({selectedChatId})
                        $(document).find(`.user-chat-history[data-chat="${selectedChatId}"]`).fadeOut().remove()
                    },
                    error: function(xhr, status, error) {
                        Swal.fire(
                            'エラー',
                            'チャットの削除に失敗しました。',
                            'error'
                        );
                    }
                });
            }
        });
    });
});
function redirectToChat(chatId) {
    localStorage.setItem('selectedChatId', chatId);
    window.location.href = '/chat/' + chatId;
}
$('.date-time').each(function() {
    var dateText = $(this).text();
    var trimmedDate = dateText.split(' ')[0]; // Get the date part only
    $(this).text(trimmedDate); // Update the element's content
});
function showDiscovery(){
    $('.onchat-on').hide()
    $('.onchat-on').addClass('d-none').css({
        'opacity': 0,
        'pointer-events': 'none',
        'visibility': 'hidden'
    });    
    $('.onchat-off').show()
    $('.onchat-off').removeClass('d-none').css({
        'opacity': '',
        'pointer-events': '',
        'visibility': ''
    }); 
}
function showChat(){
    $('.onchat-off').hide()
    $('.onchat-off').addClass('d-none').css({
        'opacity': 0,
        'pointer-events': 'none',
        'visibility': 'hidden'
    });    
    $('.onchat-on').show()
    $('.onchat-on').removeClass('d-none').css({
        'opacity': '',
        'pointer-events': '',
        'visibility': ''
    }); 
}
</script>
</body>
</html>
