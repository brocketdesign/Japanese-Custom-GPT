<script>
    chatCreationId = '{{chatId}}';
    window.isTemporaryChat = {{isTemporaryChat}};
</script>

    <!-- 1. キャラクター画像 -->
    <div id="step1" class="step">

            <!-- Character Creation Form -->
            <div id="characterCreationForm" class="container mt-3">
                
                <div class="row">
                    <!-- Left Column: Prompts and Button -->
                    <div class="col-lg-6 mb-4">
                        <div class="row mb-4">
                            <!-- Image Style Selection -->
                            <div class="row bg-light border py-2 mb-3 mx-0">
                                <h4 class="mb-4 text-start">{{translations.newCharacter.imageStyleSelectionTitle}}</h4>
                                <p class="text-start">
                                    {{translations.newCharacter.imageStyleSelectionDescription}}
                                </p>
                                <label class="form-label">{{translations.newCharacter.image_style}}</label>
                                <div id="imageStyleSelectionCharacterCreation" class="d-flex flex-row flex-nowrap overflow-auto mb-4"></div>
                                <input type="hidden" id="modelId" name="modelId" required>
                                <input type="hidden" id="imageStyle" name="imageStyle" required>
                                <input type="hidden" id="imageModel" name="imageModel" required>
                                <input type="hidden" id="imageVersion" name="imageVersion" required>
                            </div>

                            <div class="row justify-content-between character-generator bg-light border py-2 mb-3 mx-0">

                                <h4 class="mb-4 text-start">{{translations.newCharacter.characterPhysicalDescriptionTitle}}</h4>
                                <p class="text-start">
                                    {{translations.newCharacter.characterPhysicalDescriptionDescription}}
                                </p>

                                <!-- Gender -->
                                <div class="col-auto mb-3">
                                    <label for="gender" class="form-label"><i class="bi bi-asterisk text-danger me-2"></i>{{translations.newCharacter.genderLabel}}:</label>
                                    <select class="form-select" id="gender" name="gender">
                                        <option value="female">{{translations.newCharacter.female}}</option>
                                        <option value="male">{{translations.newCharacter.male}}</option>
                                        <option value="nonBinary">{{translations.newCharacter.nonBinary}}</option>
                                    </select>
                                </div>

                                <!-- Character Prompt Input -->
                                <div class="mb-2">
                                    <label for="characterPrompt" class="form-label"><i class="bi bi-asterisk text-danger me-2"></i>{{translations.newCharacter.character_prompt}}</label>
                                    <!-- List of tags -->
                                    <div class="mb-2">
                                        <label for="tags" class="form-label">{{translations.newCharacter.tagsLabel}}:</label>
                                        <div class="scroll-container">
                                            {{#each tags}}
                                                <span type="button" class="badge bg-light text-secondary me-1 add-tag fw-light border">{{this}}</span>
                                            {{/each}}
                                        </div>
                                    </div>
                                    <textarea
                                        class="form-control"
                                        id="characterPrompt"
                                        name="characterPrompt"
                                        rows="4"
                                        maxlength="500"
                                        placeholder="{{translations.newCharacter.character_appearance_description}}"
                                    ></textarea>

                                    <!-- Character Personnality Input -->
                                    <div class="form-check mb-1 ms-1 mt-1">
                                        <input type="checkbox" class="form-check-input" id="enableEnhancedPrompt" name="enableEnhancedPrompt" checked>
                                        <label class="form-check-label" for="enableEnhancedPrompt">{{translations.newCharacter.enable_enhanced_prompt}}</label>
                                    </div>
                                </div>


                                <div class="mb-3">
                                    <textarea
                                        class="form-control"
                                        id="enhancedPrompt"
                                        name="enhancedPrompt"
                                        rows="3"
                                        readonly
                                    ></textarea>
                                </div>

                                <div class="accordion" id="characterDescriptionAccordion">
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="headingOne">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                            <input class="form-check-input" type="checkbox" value="" id="characterDescriptionCheck">{{translations.newCharacter.character_overview}}
                                        </button>
                                        </h2>
                                        <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#characterDescriptionAccordion">
                                            <div class="accordion-body row">
                                                <a href="/my-plan" class="is-premium card py-2 custom-gradient-bg mb-3">{{translations.unlock_more_customization_fields}}</a>
                                                
                                                <!-- Age -->
                                                <div class="col-auto mb-3">
                                                    <label for="age" class="form-label">{{translations.newCharacter.ageLabel}}:</label>
                                                    <select class="form-select w-auto" id="age" name="age">
                                                        <option value="" disabled selected>{{translations.newCharacter.agePlaceholder}}</option>
                                                        <!-- Adult Age Range -->
                                                        <option value="18-24">{{translations.newCharacter.ageYoungAdult}}</option>
                                                        <option value="25-34">{{translations.newCharacter.ageAdultEarly}}</option>
                                                        <option value="35-44">{{translations.newCharacter.ageAdultMid}}</option>
                                                        <option value="45-54">{{translations.newCharacter.ageAdultLate}}</option>
                                                        <option value="55+">{{translations.newCharacter.ageSenior}}</option>
                                                    </select>
                                                </div>

                                                <!-- Build -->
                                                <div class="col-auto mb-3">
                                                    <label for="build" class="form-label">{{translations.newCharacter.buildLabel}}:</label>
                                                    <select class="form-select" id="build" name="build">
                                                        <option value="slim">{{translations.newCharacter.slim}}</option>
                                                        <option value="muscular">{{translations.newCharacter.muscular}}</option>
                                                        <option value="athletic">{{translations.newCharacter.athletic}}</option>
                                                        <option value="stocky">{{translations.newCharacter.stocky}}</option>
                                                    </select>
                                                </div>

                                                <!-- Skin Tone -->
                                                <div class="col-auto mb-3">
                                                    <label for="skinTone" class="form-label">{{translations.newCharacter.skinToneLabel}}:</label>
                                                    <select class="form-select" id="skinTone" name="skinTone">
                                                        <option value="fair">{{translations.newCharacter.fair}}</option>
                                                        <option value="medium">{{translations.newCharacter.medium}}</option>
                                                        <option value="dark">{{translations.newCharacter.dark}}</option>
                                                    </select>
                                                </div>

                                                <!-- Eye Color -->
                                                <div class="col-auto mb-3">
                                                    <label for="eyeColor" class="form-label">{{translations.newCharacter.eyeColorLabel}}:</label>
                                                    <select class="form-select" id="eyeColor" name="eyeColor">
                                                        <option value="blue">{{translations.newCharacter.blue}}</option>
                                                        <option value="brown">{{translations.newCharacter.brown}}</option>
                                                        <option value="green">{{translations.newCharacter.green}}</option>
                                                        <option value="gray">{{translations.newCharacter.gray}}</option>
                                                    </select>
                                                </div>

                                                <!-- Hair Color -->
                                                <div class="col-auto mb-3">
                                                    <label for="hairColor" class="form-label">{{translations.newCharacter.hairColorLabel}}:</label>
                                                    <select class="form-select" id="hairColor" name="hairColor">
                                                        <option value="blonde">{{translations.newCharacter.blonde}}</option>
                                                        <option value="black">{{translations.newCharacter.black}}</option>
                                                        <option value="red">{{translations.newCharacter.red}}</option>
                                                        <option value="brown">{{translations.newCharacter.brown}}</option>
                                                        <option value="gray">{{translations.newCharacter.gray}}</option>
                                                    </select>
                                                </div>

                                                <!-- Hair Length -->
                                                <div class="col-auto mb-3">
                                                    <label for="hairLength" class="form-label">{{translations.newCharacter.hairLengthLabel}}:</label>
                                                    <select class="form-select" id="hairLength" name="hairLength">
                                                        <option value="short">{{translations.newCharacter.short}}</option>
                                                        <option value="medium">{{translations.newCharacter.medium}}</option>
                                                        <option value="long">{{translations.newCharacter.long}}</option>
                                                        <option value="bald">{{translations.newCharacter.bald}}</option>
                                                    </select>
                                                </div>

                                                <!-- Hair Style -->
                                                <div class="col-12 col-sm-6 mb-3">
                                                    <label for="hairStyle" class="form-label">{{translations.newCharacter.hairStyleLabel}}:</label>
                                                    <textarea class="form-control" id="hairStyle" name="hairStyle" placeholder="{{translations.newCharacter.hairStylePlaceholder}}"></textarea>
                                                </div>

                                                <!-- Facial Features -->
                                                <div class="col-12 col-sm-6 mb-3">
                                                    <label for="facialFeatures" class="form-label">{{translations.newCharacter.facialFeaturesLabel}}:</label>
                                                    <textarea class="form-control" id="facialFeatures" name="facialFeatures" placeholder="{{translations.newCharacter.facialFeaturesPlaceholder}}"></textarea>
                                                </div>

                                                <!-- Clothing Style -->
                                                <div class="col-12 col-sm-6 mb-3">
                                                    <label for="clothingStyle" class="form-label">{{translations.newCharacter.clothingStyleLabel}}:</label>
                                                    <textarea class="form-control" id="clothingStyle" name="clothingStyle" placeholder="{{translations.newCharacter.clothingStylePlaceholder}}"></textarea>
                                                </div>

                                                <!-- Accessories -->
                                                <div class="col-12 col-sm-6 mb-3">
                                                    <label for="accessories" class="form-label">{{translations.newCharacter.accessoriesLabel}}:</label>
                                                    <textarea class="form-control" id="accessories" name="accessories" placeholder="{{translations.newCharacter.accessoriesPlaceholder}}"></textarea>
                                                </div>

                                                <!-- Tattoos/Body Art -->
                                                <div class="col-12 col-sm-6 mb-3">
                                                    <label for="tattoos" class="form-label">{{translations.newCharacter.tattoosLabel}}:</label>
                                                    <textarea class="form-control" id="tattoos" name="tattoos" placeholder="{{translations.newCharacter.tattoosPlaceholder}}"></textarea>
                                                </div>

                                                <!-- Special Features -->
                                                <div class="col-12 col-sm-6 mb-3">
                                                    <label for="specialFeatures" class="form-label">{{translations.newCharacter.specialFeaturesLabel}}:</label>
                                                    <textarea class="form-control" id="specialFeatures" name="specialFeatures" placeholder="{{translations.newCharacter.specialFeaturesPlaceholder}}"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Field to upload an image with an area -->
                                <div class="my-3">
                                    <label for="imageUpload" class="form-label">{{translations.imageForm.uploadAreaLabel}}</label>
                                    <div class="upload-area" id="uploadArea">
                                        <input type="file" class="form-control" id="imageUpload" name="imageUpload" accept="image/*" onchange="previewImage(event)">
                                    </div>
                                    <img id="imagePreview" src="#" alt="Image Preview" style="display: none; max-width: 100%; margin-top: 10px;">
                                </div>

                                              
                            </div>

                            <div class="row justify-content-between bg-light border py-2 mb-3 mx-0 character-personnality-">

                                <!-- 3. CHaracter Personnalityy -->
                                <h4 class="mb-4 text-start">{{translations.newCharacter.characterPersonalityTitle}}</h4>
                                <p class="text-start">
                                    {{translations.newCharacter.characterPersonalityDescription}}
                                </p>

                                <!-- Name -->
                                <div class="row mx-0 px-0">
                                    <div class="col-12 col-sm-6 mb-3">
                                        <label for="chatName" class="form-label">{{translations.newCharacter.nameLabel}}:</label>
                                        <input type="text" class="form-control" id="chatName" name="chatName" placeholder="{{translations.newCharacter.namePlaceholder}}">
                                    </div>
                                </div>
                                    
                                <div id="chatPurpose-container" class="mb-3">
                                    <div class="d-flex justify-content-between">
                                        <label for="chatPurpose" class="form-label">{{translations.newCharacter.characterDetailsLabel}}</label>
                                    </div>
                                    <textarea class="form-control mb-2" id="chatPurpose" name="content" rows="3" placeholder="{{translations.newCharacter.characterDetailsPlaceholder}}"></textarea>
                                </div>

                                <div class="accordion" id="personalityAccordion">
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="personalityHeadingOne">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#personalityCollapseOne" aria-expanded="true" aria-controls="personalityCollapseOne">
                                            <input class="form-check-input" type="checkbox" value="" id="personalityCheck">{{translations.newCharacter.detailed_personality}}
                                        </button>
                                        </h2>
                                        <div id="personalityCollapseOne" class="accordion-collapse collapse" aria-labelledby="personalityHeadingOne" data-bs-parent="#personalityAccordion">
                                            <div class="accordion-body row">
                                                <a href="/my-plan" class="is-premium  card py-2  custom-gradient-bg  mb-3">{{translations.unlock_more_customization_fields}}</a>
                                            
                                                <!-- Personality Feature -->
                                                <div class="col-auto mb-3">
                                                    <label for="personality" class="form-label">{{translations.newCharacter.personalityLabel}}:</label>
                                                    <select class="form-select" id="personality" name="personality">
                                                        <option value="optimistic">{{translations.newCharacter.optimistic}}</option>
                                                        <option value="pessimistic">{{translations.newCharacter.pessimistic}}</option>
                                                        <option value="realistic">{{translations.newCharacter.realistic}}</option>
                                                        <option value="idealistic">{{translations.newCharacter.idealistic}}</option>
                                                    </select>
                                                </div>

                                                <!-- Tone Feature -->
                                                <div class="col-auto mb-3">
                                                    <label for="tone" class="form-label">{{translations.newCharacter.toneLabel}}:</label>
                                                    <select class="form-select" id="tone" name="tone">
                                                        <option value="friendly">{{translations.newCharacter.friendly}}</option>
                                                        <option value="serious">{{translations.newCharacter.serious}}</option>
                                                        <option value="sarcastic">{{translations.newCharacter.sarcastic}}</option>
                                                        <option value="humorous">{{translations.newCharacter.humorous}}</option>
                                                    </select>
                                                </div>

                                                <!-- Morality -->
                                                <div class="col-auto mb-3">
                                                    <label for="morality" class="form-label">{{translations.newCharacter.moralityLabel}}:</label>
                                                    <select class="form-select" id="morality" name="morality">
                                                        <option value="good">{{translations.newCharacter.good}}</option>
                                                        <option value="neutral">{{translations.newCharacter.neutral}}</option>
                                                        <option value="evil">{{translations.newCharacter.evil}}</option>
                                                    </select>
                                                </div>

                                                <!-- Motivation -->
                                                <div class="col-12 col-sm-6 mb-3">
                                                    <label for="motivation" class="form-label">{{translations.newCharacter.motivationLabel}}:</label>
                                                    <textarea class="form-control" id="motivation" name="motivation" placeholder="{{translations.newCharacter.motivationPlaceholder}}"></textarea>
                                                </div>

                                                <!-- Strengths -->
                                                <div class="col-12 col-sm-6 mb-3">
                                                    <label for="strengths" class="form-label">{{translations.newCharacter.strengthsLabel}}:</label>
                                                    <textarea class="form-control" id="strengths" name="strengths" placeholder="{{translations.newCharacter.strengthsPlaceholder}}"></textarea>
                                                </div>

                                                <!-- Weaknesses -->
                                                <div class="col-12 col-sm-6 mb-3">
                                                    <label for="weaknesses" class="form-label">{{translations.newCharacter.weaknessesLabel}}:</label>
                                                    <textarea class="form-control" id="weaknesses" name="weaknesses" placeholder="{{translations.newCharacter.weaknessesPlaceholder}}"></textarea>
                                                </div>

                                                <!-- Fears -->
                                                <div class="col-12 col-sm-6 mb-3">
                                                    <label for="fears" class="form-label">{{translations.newCharacter.fearsLabel}}:</label>
                                                    <textarea class="form-control" id="fears" name="fears" placeholder="{{translations.newCharacter.fearsPlaceholder}}"></textarea>
                                                </div>

                                                <!-- Secrets -->
                                                <div class="col-12 col-sm-6 mb-3">
                                                    <label for="secrets" class="form-label">{{translations.newCharacter.secretsLabel}}:</label>
                                                    <textarea class="form-control" id="secrets" name="secrets" placeholder="{{translations.newCharacter.secretsPlaceholder}}"></textarea>
                                                </div>
                                        </div>
                                    </div>
                                </div>
                                </div>
                            </div>
                                                    
                            <!-- 4. Single Action Button -->
                            <div class="row mx-0">
                                <button type="button" id="generateButton" class="btn custom-gradient-bg btn-lg text-white">
                                    <i class="fas fa-magic me-2"></i>{{translations.newCharacter.generate_with_AI}}
                                </button>
                                <span class="w-100 text-center text-muted genexp" style="font-size: 12px;display:none;">{{translations.newCharacter.image_generation_message}}</span>
                            </div>

                        </div>
                    </div>

                    <!-- Right Column: Generated Image -->
                    <div class="col-lg-6 mb-4 d-flex flex-column align-items-center">
                        <!-- 3. Generated Image Display -->
                        <label class="form-label d-block mb-2 text-center">{{translations.newCharacter.generatedImageLabel}}</label>
                        <div id="imageContainer" class="row mb-4 w-100">
                            <img
                                id="generatedImage"
                                src="/img/default-character.png"
                                alt="{{translations.newCharacter.generatedImageAlt}}"
                                class="img-fluid rounded"
                                style="max-height: 300px; width: 100%; object-fit: contain;"
                            >
                        </div>
                        <div id="imageUploaderContainer" class="w-100" style="cursor: pointer;">
                            <!-- You can add an image uploader here if needed -->
                        </div>
                        <div class="row w-100 chatRedirection" style="display:none;">
                            <span type="button" id="redirectToChat" class="btn custom-gradient-bg  mt-3">{{translations.newCharacter.start_chat_and_image_generation}}</span>
                            <p class="text-center text-muted mt-2">{{translations.newCharacter.start_chat_and_image_generation_description}}</p>
                        </div>
                      
                    </div>
                </div> 
        </div>
    </div>
</body>
</html>
