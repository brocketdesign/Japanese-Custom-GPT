<div class="px-2 position-relative onchat-on" style="flex-grow:1;height: auto;">
    <div id="chatInput" class="input-group rounded-0 rounded-bottom" style="position: absolute;bottom: 10px;left: 0;right: 0;padding: 0px 15px 5px 15px;">
        <div class="chat-toolbar-wrapper">
            <div class="chat-toolbar-container">
                <!-- Main Toolbar -->
                <div class="chat-toolbar animate__animated animate__slideInUp">
                    <div id="toolbar-main" class="toolbar-scroll-container">
                        <button type="button" class="toolbar-btn" id="audio-play">
                            <i class="bi" id="audio-icon"></i>
                        </button>
                        <button type="button" class="toolbar-btn" id="text-input-toggle">
                            <i class="bi bi-chat-dots"></i>
                        </button>
                        <button type="button" class="toolbar-btn" id="show-personas-btn">
                            <i class="bi bi-person-lines-fill"></i>
                        </button>
                        <button type="button" class="toolbar-btn" id="showPrompts">
                            <i class="bi bi-image"></i>
                        </button>
                        <button type="button" class="toolbar-btn" id="emoji-tone-btn">
                            <i class="bi bi-emoji-smile"></i>
                        </button>
                        <button type="button" class="toolbar-btn" id="suggestions-toggle">
                            <i class="bi bi-lightbulb"></i>
                        </button>
                        <button type="button" class="toolbar-btn" id="translation-toggle">
                            <i class="bi bi-translate"></i>
                        </button>
                        <button type="button" class="toolbar-btn reset-chat" id="reset-chat-btn" onclick="handleChatReset(this)">
                            <i class="bi bi-plus-square"></i>
                        </button>
                    </div>
                    
                    <!-- Tool Content Views -->
                    <!-- Emoji tone view -->
                    <div id="toolbar-emoji-tone" class="toolbar-content-view animate__animated" style="display: none;">
                        <button type="button" class="toolbar-back-btn">
                            <i class="bi bi-arrow-left"></i>
                        </button>
                        <div class="toolbar-title">é¸æŠãƒˆãƒ¼ãƒ³</div>
                        <div class="emoji-scroll-container">
                            <button class="emoji-btn" data-tone="happy">ğŸ˜Š</button>
                            <button class="emoji-btn" data-tone="funny">ğŸ˜‚</button>
                            <button class="emoji-btn" data-tone="romantic">â¤ï¸</button>
                            <button class="emoji-btn" data-tone="serious">ğŸ§</button>
                            <button class="emoji-btn" data-tone="sad">ğŸ˜¢</button>
                            <button class="emoji-btn" data-tone="angry">ğŸ˜¡</button>
                            <button class="emoji-btn" data-tone="surprised">ğŸ˜²</button>
                            <button class="emoji-btn" data-tone="confused">ğŸ˜•</button>
                            <button class="emoji-btn" data-tone="neutral">ğŸ˜</button>
                            <button class="emoji-btn" data-tone="excited">ğŸ¤©</button>
                            <button class="emoji-btn" data-tone="bored">ğŸ˜´</button>
                            <button class="emoji-btn" data-tone="curious">ğŸ¤”</button>
                            <button class="emoji-btn" data-tone="playful">ğŸ˜œ</button>
                            <button class="emoji-btn" data-tone="relaxed">ğŸ˜Œ</button>
                            <button class="emoji-btn" data-tone="motivated">ğŸ’ª</button>
                            <button class="emoji-btn" data-tone="inspired">âœ¨</button>
                            <button class="emoji-btn" data-tone="nostalgic">ğŸ˜Œ</button>
                            <button class="emoji-btn" data-tone="hopeful">ğŸŒŸ</button>
                            <button class="emoji-btn" data-tone="grateful">ğŸ™</button>
                            <button class="emoji-btn" data-tone="determined">ğŸ”¥</button>
                        </div>
                    </div>
                    
                    <!-- Suggestions view -->
                    <div id="toolbar-suggestions" class="toolbar-content-view animate__animated" style="display: none;">
                        <button type="button" class="toolbar-back-btn">
                            <i class="bi bi-arrow-left"></i>
                        </button>
                        <div class="toolbar-title">ææ¡ˆ</div>
                        <div id="suggestions" class="suggestions-scroll-container">
                            <!-- Suggestions will be dynamically added here -->
                        </div>
                    </div>
                    
                    <!-- Translation view -->
                    <div id="toolbar-translation" class="toolbar-content-view animate__animated" style="display: none;">
                        <button type="button" class="toolbar-back-btn">
                            <i class="bi bi-arrow-left"></i>
                        </button>
                        <div class="toolbar-title">{{translations.translate}}</div>
                        <div class="translation-scroll-container">
                            <button class="translation-btn" data-lang="en">{{translations.english}}</button>
                            <button class="translation-btn" data-lang="ja">{{translations.japanese}}</button>
                            <button class="translation-btn" data-lang="ko">{{translations.korean}}</button>
                            <button class="translation-btn" data-lang="zh">{{translations.chinese}}</button>
                            <button class="translation-btn" data-lang="fr">{{translations.french}}</button>
                            <button class="translation-btn" data-lang="de">{{translations.german}}</button>
                        </div>
                    </div>
                    
                    <!-- Text input view -->
                    <div id="toolbar-text-input" class="toolbar-content-view animate__animated" style="display: none;">
                        <button type="button" class="toolbar-back-btn">
                            <i class="bi bi-arrow-left"></i>
                        </button>
                        <div class="input-group w-100">
                            <textarea id="userMessage" class="form-control py-2 border-0" style="max-height: 80px;" placeholder="ãƒãƒ£ãƒƒãƒˆã—ã‚ˆã†"></textarea>
                            <button id="sendMessage" class="btn btn-light px-3 border-0" type="button">
                                <i class="bi bi-send"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="personas-overlay">
            <div id="personas-container" class="shadow" style="position: absolute; bottom: -10px; width: 95%; margin: auto; max-height: 55vh; background: rgb(255, 255, 255); overflow-y: auto; left: 0; right: 0; z-index: 10; border-radius: 15px 15px 0 0; display: none;">
                <button id="close-personas-container" class="btn shadow-0 position-absolute top-0 end-0"><i class="bi bi-x"></i></button>
                <div id="personas-list" class="row mx-0 my-5">
                    <h4 class="text-center w-100 mt-2">{{translations.personas.selectPersona}}</h4>
                    <p class="text-center text-muted w-100">{{translations.personas.selectPersona_description}}</p>
                    <div id="persona-activated-counter" class="text-center fw-bold my-2"></div>
                    <div class="loading-spinner text-center mt-4">
                        <div class="spinner-border" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="promptContainer" class="shadow" style="position: absolute; bottom: -10px; width: 95%; margin: auto; max-height: 55vh; background: rgb(255, 255, 255); overflow-y: auto;left: 0;right: 0;z-index: 10;border-radius: 15px 15px 0 0;display:none;">
            <button id="close-promptContainer" class="btn shadow-0 position-absolute top-0 end-0"><i class="bi bi-x"></i></button>
            <div id="promptList" class="row mx-0 my-5">
                <h4 class="text-center w-100 mt-2">{{translations.selectPose}}</h4>
                <p class="text-center text-muted w-100">{{translations.selectPose_description}}</p>
                <!-- Prompts will be dynamically generated here -->
                {{#each promptData}}
                    <div class="prompt-card col-6 col-sm-3 border-0 shadow-0 mb-1 position-relative inactive d-flex justify-content-center align-items-center"
                        data-id="{{_id}}" 
                        data-nsfw="{{eq nsfw 'on'}}" 
                        style="cursor:pointer; min-height: 200px;">
                        <div class="image-container d-inline-flex align-items-center justify-content-center p-0 m-0 rounded border" style="background:transparent; padding:0; margin:0;">
                            <img 
                                src="/img/image-placeholder-1.gif"
                                data-src="{{image}}" 
                                class="lazy-image rounded"
                                alt="{{title}}" 
                                style="display:block; max-width:100%; max-height:200px; object-fit:contain;">
                        </div>
                    </div>
                {{/each}}

            </div>
        </div>
    </div>
</div>

