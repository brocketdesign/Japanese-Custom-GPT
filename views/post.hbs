<!DOCTYPE html>
<html lang="ja">
       {{> dashboard-header}}
<body>
    {{> dashboard-nav}}
    <style>
        footer{display:none}
        .isLoading .fa-image{
            display: none;
        }
        .isLoading .fa-spin{
            display: inherit !important;
        }
        
        .custom-gradient-bg {
            background: linear-gradient(90.9deg, #D2B8FF 2.74%, #8240FF 102.92%);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: color 0.3s ease-in-out;
        }

        .custom-gradient-bg::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 300%;
            height: 300%;
            background: radial-gradient(circle, rgba(255,255,255,0.5) 0%, rgba(255,255,255,0) 80%);
            transform: translate(-50%, -50%) scale(0);
            transition: transform 0.5s ease-in-out;
            z-index: 0;
        }

        .custom-gradient-bg:hover::before {
            transform: translate(-50%, -50%) scale(1);
        }

        .custom-gradient-bg:hover {
            color: #fff;
        }

        .text-muted {
            color: #aeb0b4 !important;
            font-weight: 300;
        }
        .u-color-grad {
          background: linear-gradient(90.9deg, rgba(110, 32, 244, 0.5) 2.74%, #6E20F4 102.92%);
            background-clip: border-box;
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          margin-right: 6px;
          letter-spacing: 0;
          font-size: 26px;
          line-height: 1;
        }
        .avatar{
            object-fit: cover;
            object-position: top;
            width: 32px;
        }
        .card-img-top.girls_avatar {
            object-fit: cover;
            object-position: top;
            width: 100%;  
            margin: auto;
            border-radius: 15px;
            height: 350px;
            padding: 0 5px;  
            background-position: top;
            background-size: cover;
        }
        .swal-image.analyze{
            object-fit: cover;
            object-position: top;
            width: auto !important;
            height: 200px !important;
            border-radius: 6px !important;
        }
        .card-header, .card-footer {
            flex-shrink: 0;
        }
        .card-body {
            flex-grow: 1;
            overflow-y: auto;
            position: relative;
        }
        .chat-contain .card-body{
                width: 100%;
        }
        .character-title{
            font-weight: 600;
            font-size: 16px;
            color: black;
        }
        .character-short-description {
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            font-size: 13px;
        }
        .scroll-horizontal {
            flex-wrap: nowrap;
            width: 100%;
            flex-direction: row;
            overflow-x: scroll;
        }
        .liked i{
          color:red;
        }
        @media (max-width: 600px) {
            .chat-contain .card-body{
                width: 100%;
            }
        }
    </style>
    <div class="container mt-4">
      <!-- Row for User Profile and Post Content -->
      <div class="row mx-0">

        <!-- Post Content Section -->
        {{#if post}}
        <div class="col-lg-8 mb-4">
          <div class="card">
            <img src="{{post.image.imageUrl}}" class="card-img-top" alt="{{post.prompt}}" style="max-height:400px;width:auto;object-fit:contain;">
            <div class="card-body">
              <h5 class="card-title">{{post.prompt}}</h5>
              <p class="card-text">{{post.comment}}</p>
              <p class="text-muted"><span class="jp-date">{{post.createdAt}}</span></p>
              <div class="d-flex justify-content-between align-items-center">
                <button class="btn btn-light shadow-0 post-fav {{#if  (includesObjectId post.likedBy user._id) }}liked{{/if}}" data-id="{{post._id}}"> <i class="bi bi-heart-fill me-2"></i>{{translations.like}} <span class="ct d-none">{{default post.likes 0}}</span></button>
                <button class="btn btn-light shadow-0 post-visible d-none {{#if (eq post.userId user._id) }}{{else}}d-none{{/if}} {{#if post.isPrivate}}private{{/if}}" data-id="{{post._id}}"><i class="bi {{#if post.isPrivate}}bi-eye-slash{{else}}bi-eye{{/if}} me-2"></i><span class="text">{{#if post.isPrivate}}éå…¬é–‹{{else}}å…¬é–‹{{/if}}</span></button>
                <a href="/chat/{{post.chatId}}" class="btn btn-outline-secondary"> <i class="bi bi-chat-dots me-2"></i>{{translations.startChatting}}</a>
              </div>
            </div>
          </div>
        </div>
        {{/if}}
        <!-- User Profile Section -->
        {{#if postUser}}
        <div class="col-lg-4 mb-4">
          <div class="card">
            <div class="card-body text-center">
              <div class="user-profile mt-4">
                <div class="row mx-0 mb-3">
                  <div id="profileSection" class="text-center">
                    <div class="mx-auto p-auto text-center d-flex align-items-center justify-content-center position-relative mb-2">
                      <a href="/user/{{postUser._id}}" class="text-secondary" style="text-decoration:none;">  
                        <img id="profileImage" src="{{default postUser.profileUrl '/img/avatar.png'}}" alt="chat Thumbnail" class="rounded-circle" 
                        style="width: 100px; height: 100px; object-fit: cover; object-position: top;">
                      </a>
                    </div>
                    <a href="/user/{{postUser._id}}" class="text-secondary" style="text-decoration:none;">
                      <h2>{{postUser.nickname}}</h2>
                    </a>
                    <span class="btn btn-light me-2">
                        <span>ğŸª™</span>
                        <span class="user-coins fw-bold">{{postUser.coins}}</span>
                    </span>
                    {{#if postUser.bio}}
                        <p class="user-bio fw-bold">{{postUser.bio}}</p>
                    {{/if}}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        {{/if}}
      </div>
    </div>

<section class="container">
  {{#if userId}}
  <div class="row mx-0 justify-content-center">
    <div class="col-12 mt-4">
        <h4>æŠ•ç¨¿ã—ãŸAIç”»åƒ</h4>
        <hr>
        <div id="user-posts-gallery" class="row mx-0 g-3"></div>
        <div id="pagination-controls" class="d-flex justify-content-center my-3"></div>
    </div>
  </div>
  {{else}}
  <h3 class="my-4 text-center">ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‹ã‚‰ã®æœ€æ–°æŠ•ç¨¿</h3>
  <p>Lamixã§ã¯ã€AIã‚°ãƒ©ãƒ“ã‚¢ã¨ã®ãƒãƒ£ãƒƒãƒˆä¸­ã«ç”Ÿæˆã•ã‚ŒãŸç”»åƒã‚’ä½¿ã£ã¦ã€ç°¡å˜ã«æŠ•ç¨¿ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãŠæ°—ã«å…¥ã‚Šã®ç¬é–“ã‚„ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãªç”»åƒã‚’ã‚·ã‚§ã‚¢ã™ã‚‹ã“ã¨ã§ã€ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨æ¥½ã—ã•ã‚’å…±æœ‰ã—ã¾ã—ã‚‡ã†ã€‚ç”»åƒã‚’é¸ã‚“ã§æŠ•ç¨¿ã«è¿½åŠ ã™ã‚‹ã ã‘ã§ã€ã‚ãªãŸã ã‘ã®ã‚ªãƒªã‚¸ãƒŠãƒ«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç°¡å˜ã«ç™ºä¿¡ã§ãã¾ã™ã€‚</p>
    
  <div class="container mt-4 mb-5">
    <div class="row mx-0" id="post-gallery"></div>
    <div class="d-flex justify-content-center mt-4" id="user-posts-pagination-controls"></div>
  </div>

  {{/if}}
</section>

<style>
  footer{display: inline !important;}
</style>
{{> dashboard-footer}}

<script>

  $(document).ready(function () {
    const userId = `{{{postUser._id}}}`;
    if(userId){
      loadUserPosts(userId, 1);
    }else{
      loadAllUserPosts(1);
    }
  });

</script>
