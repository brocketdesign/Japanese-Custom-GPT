<!DOCTYPE html>
<html lang="{{user.lang}}">
    {{> dashboard-header}}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <link rel="stylesheet" href="/css/chat-suggestions.css">
    <link rel="stylesheet" href="/css/speech-to-text.css">
    <link rel="stylesheet" href="/css/chat-scenario.css">
    <link rel="stylesheet" href="/css/chat-goals-widget.css">
    <link rel="stylesheet" href="/css/chat-list-tabs.css">
    <link rel="stylesheet" href="/css/chat-history-sidebar.css">
<body>
    {{> onboarding-modals}}
    <!-- Fullscreen overlay with loading spinner -->
    <div class="fullscreen-overlay justify-content-center align-items-center" id="loadingOverlay">
        <div style="position: relative; display: flex; justify-content: center; align-items: center;"> <!-- Wrapper for logo and spinner -->
            <div class="loading-circle shadow" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <div style="z-index: 10;">
                <div class="brand-logo rounded-circle bg-white" style="width: 100px; height: 100px;background: white;">
                    <i class="bi bi-chat-heart-fill" style="font-size: 3em; color: #b58afe;"></i>
                </div>
            </div>
        </div>
    </div>
    <div id="swup-none">
        <div id="overlay" class="d-sm-none bg-dark" style="position: fixed; inset: 0; z-index: 1033; display: none; opacity: 0.4; overflow: hidden;"></div>
        <div class="content collapsed">
            <nav class="navbar navbar-expand-lg navbar-white bg-transparent fixed-top shadow-0 flex-column" style="z-index: 1020;">
                <div class="container-fluid">
                    <div class="d-flex align-items-center justify-content-center">
                        <div style="position: absolute;left: 20px;top: 10px;">
                            <button 
                            class="btn badge-sm text-white shadow-0 onchat-on goBackButton" 
                            style="display: none;background-color: color(display-p3 0.731 0.632 0.98 / 0.17);"
                            onclick="showDiscovery()"><i class="bi bi-arrow-left"></i></button>

                            <div id="chat-actions-dropdown" class="dropdown d-inline-block onchat-on" style="display: none;">
                                <button 
                                class="btn badge-sm text-white shadow-0 dropdown-toggle" 
                                style="background-color: color(display-p3 0.731 0.632 0.98 / 0.17);"
                                type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="bi bi-three-dots"></i>
                                </button>
                                <ul class="dropdown-menu shadow border-0">
                                    <!-- Dropdown items will be populated by JavaScript -->
                                </ul>
                            </div>
                        </div>
                        <div class="d-flex flex-row " style="cursor: pointer; min-height: 40px;" onclick="showDiscovery()">
                            <div class="brand-logo me-3 onchat-off" style="display: flex; position: absolute; left: 10px;">
                                <i class="bi bi-chat-heart-fill text-white fs-3"></i>
                            </div>
                        </div>  
                        <div>
                            <div class="navbar-collapse" id="navbarNav" style="position: absolute;right: -50vw;top: 10px;">
                                <ul class="navbar-nav ms-auto flex-row mb-lg-0">
                                    {{> dashboard-avatar}}
                                </ul>
                            </div>
                        </div>   
                    </div>
                </div>
            {{> chat-header}}
            </nav>
            {{> chat-list}}
            <section id="chat-discovery" class="onchat-off" style="display: block; padding-top: 180px;">

                <!-- Sorting Tools: Premium/Free, Gender & NSFW Filters (Responsive) -->
                <div class="mx-4 sorting-tools mb-3">
                    <div class="row g-3 align-items-center">

                        <!-- Query Tags Horizontal Scroll Section -->
                        <div class="query-tags-section mb-1 native-section d-flex flex-wrap align-items-center">

                            <!-- Action buttons container -->
                            <div class="d-flex align-items-center flex-shrink-0 me-3">
                                <button id="reload-latest-chats" class="btn-flat-border btn-outline-primary me-1" style="border: none!important; background-color: color(srgb 0.5022 0.2316 0.965 / 0.2) !important;font-size: 0.9em;">
                                    <i class="bi bi-arrow-clockwise me-1"></i>{{#if translations.recent}}{{translations.recent}}{{else}}Recent{{/if}}
                                </button>
                                <button id="reload-latest-video-chats" class="btn-flat-border btn-outline-primary me-1" style="border: none!important; background-color: color(srgb 0.5022 0.2316 0.965 / 0.2) !important;font-size: 0.9em;">
                                    <i class="bi bi-film me-1"></i>{{#if translations.recentVideos}}{{translations.recentVideos}}{{else}}Recent Videos{{/if}}
                                </button>
                                <!-- Toggle NSFW button -->
                                <button id="toggle-nsfw-btn" class="toggle-nsfw-btn btn-flat-border btn-outline-primary me-1" style="border: none!important; background-color: color(srgb 0.5022 0.2316 0.965 / 0.2) !important;font-size: 0.9em;">
                                    <i class="bi bi-toggle-off mx-2"></i><i class="bi bi-toggle-on mx-2"></i>{{#if translations.toggle_nsfw}}{{translations.toggle_nsfw}}{{else}}NSFW{{/if}}
                                </button>

                                <div class="dropdown d-none">
                                    <button class="btn-flat-border btn-outline-primary dropdown-toggle d-flex align-items-center gap-2" 
                                            type="button" 
                                            data-bs-toggle="dropdown" 
                                            aria-expanded="false"
                                            style="border: none!important; 
                                                background-color: color(srgb 0.5022 0.2316 0.965 / 0.2) !important;">
                                        <span id="selected-gender-text">
                                            <i class="bi bi-gender-female me-1"></i>{{translations.sort.female}}
                                        </span>
                                    </button>

                                    <ul class="dropdown-menu shadow-sm" style="border-radius: 16px; overflow: hidden;">
                                        <li>
                                            <button class="dropdown-item d-flex align-items-center gap-2 px-3 py-2" 
                                                    data-gender="female"
                                                    type="button">
                                                <i class="bi bi-gender-female text-primary"></i>
                                                <span>{{translations.sort.female}}</span>
                                            </button>
                                        </li>
                                        <li>
                                            <button class="dropdown-item d-flex align-items-center gap-2 px-3 py-2" 
                                                    data-gender="male"
                                                    type="button">
                                                <i class="bi bi-gender-male text-info"></i>
                                                <span>{{translations.sort.male}}</span>
                                            </button>
                                        </li>
                                        <li>
                                            <button class="dropdown-item d-flex align-items-center gap-2 px-3 py-2" 
                                                    data-gender="nonbinary"
                                                    type="button">
                                                <i class="bi bi-gender-trans text-success"></i>
                                                <span>{{translations.sort.nonBinary}}</span>
                                            </button>
                                        </li>
                                    </ul>
                                </div>
                                
                            </div>
                            <div class="query-tags-scroll-container flex-grow-1">
                                <div class="query-tags-list d-flex p-0 mt-2" id="query-tags-list" style="overflow-y: none;">
                                    <!-- Query tags will be populated here -->
                                    <div class="spinner-border spinner-border-sm me-3" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Popular chats section -->
                <div id="popular-chats-section">

                    <div id="all-chats-container" class="row g-3 all-chats-gallery mx-0"></div>
                    <div class="d-flex justify-content-center" id="all-chats-images-pagination-controls" style="opacity: 0;"></div>
                    
                    <div id="latest-chats-gallery" class="row latest-chats-gallery mx-0"></div>

                    <div id="latest-video-chats-gallery" class="row pb-3 px-3 mx-0"></div>
                    <div id="latest-video-chats-pagination-controls" class="text-center mt-3" style="opacity: 0;"></div>

                    <div id="chat-gallery" class="row g-3 popular-chats-gallery mx-0"></div>                    
                    <div id="chat-pagination-controls" class="my-3" style="opacity: 0;"></div>
                </div>
            </section>
            <div id="chat-wrapper" class="px-0 onchat-on" style="background-color: color(srgb 0.055 0.0501 0.0501 / 0.97);background-position: top center;background-repeat: no-repeat;position: relative;">
                <!-- Chat Container Overlay -->
                <div id="chat-container" class="container mx-auto shadow-0 border-0 rounded-0" style="border-radius:0 !important;position: relative;">
                    <div class="chat-overlay d-flex justify-content-center align-items-center w-100 h-100vh position-absolute top-0 start-0 bottom-0" id="chatOverlay" style="opacity: 0.85;"></div>
                    
                    <div class="card-body text-center p-0 container" style="min-height:250px;overflow-y:hidden;display: flex;flex-direction: column;position: relative;z-index: 990;">
                        <!-- Chat Scenarios Container - positioned absolutely but within chat wrapper to avoid toolbar overlap -->
                        <div class="scenario-container"></div>
                        <div id="chatContainer" data-id="" class="pt-2 fade-content" style="padding-bottom: 180px !important;"></div>
                    </div>
                </div>  
            </div>  
        </div>
    </div>
 {{> dashboard-footer}}

    <script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.19.0/js/md5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="/js/merge-face.js"></script>
    <script src="/js/txt2speech.js"></script>
    <script src="/js/dashboard-category.js"></script>
    <script src="/js/chat-tool-swiper.js"></script>
    <script src="/js/chat-tool-toolbar.js"></script>
    <script src="/js/chat-list.js"></script>
    <script src="/js/favorites.js"></script>
    <script src="/js/chat-tool-prompts.js"></script>
    <script src="/js/chat-tool-gifts.js"></script>
    <script src="/js/chat-tool-settings.js"></script>
    <script src="/js/chat-tool-message.js"></script>
    <script src="/js/chat-tool-goals.js"></script>
    <script src="/js/chat-suggestions.js"></script>
    <script src="/js/chat-scenario.js"></script>
    <script src="/js/chat-footer.js"></script>
    <script src="/js/live-goals-widget.js"></script>
    <script src="/js/chat.js"></script>
    <script src="/js/character-infos.js"></script>
    <script src="/js/img2video.js"></script>
    <script src="/js/speech-to-text-init.js"></script>
    <script src="/js/speech-to-text-ui.js"></script>
    <script src="/js/speech-to-text-utils.js"></script>

    <!-- Modularized scripts extracted from inline block -->
    <script src="/js/modules/layout-adjustments.js"></script>
    <script src="/js/modules/iframe-communication.js"></script>
    <script src="/js/modules/chat-history.js"></script>
    <script src="/js/modules/popular-chats.js"></script>
    <script src="/js/modules/latest-chats.js"></script>
    <script src="/js/modules/chat-filters.js"></script>
    <script src="/js/modules/ui-helpers.js"></script>
    <script src="/js/modules/checkout.js"></script>
    <script src="/js/modules/init.js"></script>

</body>
</html>