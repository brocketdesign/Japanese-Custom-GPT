<!DOCTYPE html>
<html lang="{{lang}}">
{{> dashboard-header}}
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="/css/character.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
</head>

<body>
    {{> dashboard-nav}}

    <div class="profile-container" id="characterProfilePage" data-chat-id="{{#if chat}}{{chat._id}}{{/if}}" data-chat-personality="{{#if chat}}{{json chat.base_personality}}{{/if}}">
        {{#if chat}}
            <!-- Profile Header -->
            <div class="profile-header">
                <div class="profile-cover">
                    <div class="profile-avatar-container">
                        {{#if image}}
                            {{#unless isBlur}}
                                <img class="profile-avatar" src="{{image.imageUrl}}" alt="{{chat.name}}" id="mainProfileImage">
                            {{else}}
                                <img class="profile-avatar img-blur" src="{{image.imageUrl}}" alt="{{chat.name}}" onclick="{{#if user.isTemporary}}openLoginForm(){{else}}loadPlanPage(){{/if}}">
                            {{/unless}}
                        {{else}}
                            <img class="profile-avatar" src="{{default chat.chatImageUrl '/img/avatar.png'}}" alt="{{chat.name}}">
                        {{/if}}
                    </div>
                    
                    <div class="profile-info">
                        <h1 class="profile-name">{{chat.name}}</h1>
                        {{#if chat.short_intro}}
                            <p class="profile-intro">{{chat.short_intro}}</p>
                        {{else}}
                            <p class="profile-intro">{{chat.description}}</p>
                        {{/if}}
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="profile-actions">
                <a href="{{#if user.isTemporary}}#{{else}}/chat/{{chat._id}}{{/if}}" 
                   onclick="{{#if user.isTemporary}}openLoginForm(); return false;{{/if}}" 
                   class="action-btn action-btn-primary">
                    <i class="bi bi-chat-dots"></i>
                    {{translations.startChattingNow}}
                </a>
                {{#unless user.isTemporary}}
                    <button class="action-btn action-btn-secondary share-btn">
                        <i class="bi bi-share"></i>
                        {{translations.share}}
                    </button>
                {{/unless}}
            </div>

            {{#if isAdmin}}
            <!-- Admin Controls -->
            <div class="admin-controls" style="margin-top: 10px; padding: 10px; background: rgba(0,0,0,0.05); border-radius: 8px;">
                <div class="d-flex justify-content-center gap-2 flex-wrap">
                    <button class="btn btn-sm btn-info set-sfw-thumbnail-btn" 
                            data-id="{{chat._id}}" 
                            onclick="setSFWThumbnail(this);" 
                            title="Set SFW Thumbnail">
                        <i class="bi bi-image me-1"></i>Set SFW Thumbnail
                    </button>
                    <button class="btn btn-sm chat-nsfw-toggle {{#if chat.nsfw}}nsfw{{else}}sfw{{/if}}" 
                            data-id="{{chat._id}}" 
                            onclick="toggleChatNSFW(this);"
                            title="Toggle NSFW">
                        <i class="bi {{#if chat.nsfw}}bi-eye-slash{{else}}bi-eye{{/if}} me-1"></i>
                        {{#if chat.nsfw}}NSFW{{else}}SFW{{/if}}
                    </button>
                </div>
            </div>
            {{/if}}

            <!-- Stats Section -->
            <div class="profile-stats">
                <div class="stat-item">
                    <span class="stat-number" id="imagesCount">0</span>
                    <div class="stat-label">{{translations.images}}</div>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="videosCount">0</span>
                    <div class="stat-label">{{translations.videos.title}}</div>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="messagesCount">0</span>
                    <div class="stat-label">{{translations.profile_messages}}</div>
                </div>
            </div>

            <!-- Content Tabs -->
            <div class="content-tabs bg-white">
                <div class="tab-nav">
                    <button class="tab-btn active" data-tab="images">
                        <i class="bi bi-grid-3x3"></i>
                        {{translations.images}}
                    </button>
                    <button class="tab-btn" data-tab="videos">
                        <i class="bi bi-film"></i>
                        {{translations.videos.title}}
                    </button>
                    <button class="tab-btn" data-tab="about">
                        <i class="bi bi-info-circle"></i>
                        {{translations.about}}
                    </button>
                </div>
            </div>

            <!-- Content Areas -->
            <div class="tab-content">
                <!-- Images Tab -->
                <div id="images-tab" class="tab-pane active">
                    <div class="media-grid" id="imagesGrid">
                        <!-- Loading state -->
                        <div class="loading-grid">
                            <div class="loading-item"></div>
                            <div class="loading-item"></div>
                            <div class="loading-item"></div>
                            <div class="loading-item"></div>
                            <div class="loading-item"></div>
                            <div class="loading-item"></div>
                        </div>
                    </div>
                </div>

                <!-- Videos Tab -->
                <div id="videos-tab" class="tab-pane" style="display: none;">
                    <div class="media-grid" id="videosGrid">
                        <!-- Videos will be loaded here -->
                    </div>
                </div>

                <!-- About Tab -->
                <div id="about-tab" class="tab-pane" style="display: none;">
                    <div class="character-details mb-2" style="max-width: 900px; margin: 0 auto; padding: 0 20px;">
                        <!-- Character Attributes Section -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 24px; margin-bottom: 40px;">
                            <!-- Style Card -->
                            <div style="background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%); border-radius: 12px; padding: 24px; border-left: 4px solid #8b5cf6;">
                                <div style="display: flex; align-items: center; margin-bottom: 12px;">
                                    <i class="bi bi-palette-fill" style="font-size: 1.5rem; color: #8b5cf6; margin-right: 12px;"></i>
                                    <h5 style="margin: 0; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; color: #6b7280; letter-spacing: 0.5px;">{{translations.profile_style}}</h5>
                                </div>
                                <p style="margin: 0; color: #374151; font-size: 1rem; font-weight: 500;">{{default chat.imageStyle 'Not specified'}}</p>
                            </div>

                            <!-- Gender Card -->
                            <div style="background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%); border-radius: 12px; padding: 24px; border-left: 4px solid #a855f7;">
                                <div style="display: flex; align-items: center; margin-bottom: 12px;">
                                    <i class="bi bi-gender-ambiguous" style="font-size: 1.5rem; color: #a855f7; margin-right: 12px;"></i>
                                    <h5 style="margin: 0; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; color: #6b7280; letter-spacing: 0.5px;">{{translations.profile_gender}}</h5>
                                </div>
                                <p style="margin: 0; color: #374151; font-size: 1rem; font-weight: 500;">{{default chat.gender 'Not specified'}}</p>
                            </div>

                            <!-- Content Rating Card -->
                            {{#if chat.nsfw}}
                            <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-radius: 12px; padding: 24px; border-left: 4px solid #f59e0b;">
                                <div style="display: flex; align-items: center; margin-bottom: 12px;">
                                    <i class="bi bi-exclamation-triangle" style="font-size: 1.5rem; color: #f59e0b; margin-right: 12px;"></i>
                                    <h5 style="margin: 0; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; color: #92400e; letter-spacing: 0.5px;">{{translations.profile_content_rating}}</h5>
                                </div>
                                <p style="margin: 0; color: #92400e; font-size: 1rem; font-weight: 600;">18+</p>
                            </div>
                            {{/if}}
                        </div>

                        <!-- Character Rules Section -->
                        {{#if chat.rule}}
                        <div style="background: white; border-radius: 12px; padding: 30px; border: 1px solid #e5e7eb; margin-bottom: 40px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                            <div style="display: flex; align-items: center; margin-bottom: 16px;">
                                <i class="bi bi-bookmark-fill" style="font-size: 1.3rem; color: #6366f1; margin-right: 10px;"></i>
                                <h4 style="margin: 0; font-size: 1.1rem; font-weight: 600; color: #1f2937;">{{translations.character_rules_heading}}</h4>
                            </div>
                            <p style="margin: 0; color: #374151; line-height: 1.8; font-size: 0.95rem;">{{chat.rule}}</p>
                        </div>
                        {{/if}}

                        <!-- Personality Section -->
                        <div id="characterPersonality"></div>

                        <!-- Tags Section -->
                        {{#if chat.tags}}
                        <div style="margin-top: 40px;">
                            <h5 style="margin: 0 0 16px 0; font-size: 0.95rem; font-weight: 600; text-transform: uppercase; color: #6b7280; letter-spacing: 0.5px;">{{translations.tags}}</h5>
                            <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                {{#each chat.tags}}
                                    <a href="/search?q={{this}}" 
                                       style="display: inline-flex; align-items: center; padding: 6px 12px; background: linear-gradient(135deg, #f3f4f6, #e5e7eb); color: #374151; border-radius: 20px; text-decoration: none; font-size: 0.85rem; font-weight: 500; transition: all 0.2s ease; border: 1px solid #d1d5db; cursor: pointer;">
                                        <i class="bi bi-tag" style="margin-right: 4px; font-size: 0.8rem;"></i>{{this}}
                                    </a>
                                {{/each}}
                            </div>
                        </div>
                        {{/if}}
                    </div>
                </div>
            </div>

            <!-- Similar Characters Section -->
            <div class="similar-section">
                <h5>{{translations.similar_characters_title}}</h5>
                <p class="text-muted small">{{translations.similar_characters_description}}</p>
                <div class="similar-grid" id="similarCharactersGrid">
                    <!-- Similar characters will be loaded here -->
                </div>
            </div>

        {{else}}
            <!-- Character Gallery for when no specific character is selected -->
            <div class="character-gallery px-0">
                <div class="container-fluid">
                    <h2 class="fw-bold">{{translations.cardMenuTitle}}</h2>
                    <p class="text-muted text-center mb-4">{{translations.exploreCharactersDescription}}</p>

                    <!-- Category Cards -->
                    <div class="category-cards-row row" id="category-cards-container" style="overflow-x: auto; overflow-y: hidden; white-space: nowrap; display: flex; flex-wrap: nowrap;">
                        <!-- Categories will be loaded here -->
                        <div class="text-center">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading categories...</span>
                            </div>
                        </div>
                    </div>

                    <!-- Query Tags Section -->
                    <div class="query-tags-section mb-4 d-none">
                        <div class="d-flex align-items-center justify-content-between mb-3" style="padding: 0 20px;">
                            <h6 class="me-3 mb-0">{{translations.browseByCategory}}:</h6>
                            <small class="text-muted">{{translations.scrollForMore}}</small>
                        </div>
                        <div class="query-tags-scroll-container">
                            <div class="query-tags-list d-flex" id="query-tags-list">
                                <!-- Query tags will be populated here -->
                                <div class="spinner-border spinner-border-sm me-3" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Character Grid -->
                    <div id="all-chats-container" class="row g-3 all-chats-gallery mx-0"></div>
                    <!-- Pagination -->
                    <div class="d-flex justify-content-center mt-4" id="all-chats-images-pagination-controls"></div>
                </div>
            </div>
        {{/if}}
    </div>

    <style>
        #footer-toolbar {
            display: none !important;
        }
    </style>
    <!-- Include required scripts -->
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <!-- Character profile modules -->
    <script src="/js/character-profile-loader.js"></script>
    <script src="/js/character-profile-ui.js"></script>
    <script src="/js/character-profile-interactions.js"></script>
    <!-- Main character profile initialization -->
    <script src="/js/modules/chat-filters.js"></script>
    <script src="/js/modules/ui-helpers.js"></script>
    <script src="/js/modules/popular-chats.js"></script>
    <script src="/js/character.js"></script>
    <script src="/js/character-infos.js"></script>
    <script src="/js/dashboard-category.js"></script>

    {{> dashboard-footer}}
    
</body>
</html>