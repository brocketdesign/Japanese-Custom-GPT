<!DOCTYPE html>
<html lang="ja">
       {{> dashboard-header}}
<body>
    {{> dashboard-nav}}

<style>

</style>
<div class="container mt-4">
  {{#if chat}}
    <!-- SEO Section -->
    <div class="row mx-0 {{#if user.isTemporary}}{{else}}d-none{{/if}}">
        <h1>{{translations.character_and_ai_chat}} {{chat.name}}</h1>
        <h3>{{translations.about_the_character}} {{chat.name}}</h3>
        <hr>
        <p>{{chat.description}}</p>
        <p>{{chat.rule}}</p>
    </div>
  {{/if}}
  <div class="row mx-0">
    <!-- Chat Image Section -->
    {{#if image}}
    <div class="col-lg-8 mb-4">
      <div class="card border-0 shadow-0">
        {{#if isBlur}}
          <div type="button" class="text-center" onclick={{#if user.isTemporary}}'showRegistrationForm()'{{else}}'unlockImage('{{image._id}}',"gallery",this)'{{/if}}>
            <img data-src="{{image.imageUrl}}" class="card-img-top img-blur" alt="{{image.prompt}}" style="max-height:400px;width:auto;object-fit:contain;">
          </div>
        {{else}}
            <img src="{{image.imageUrl}}" class="card-img-top" alt="{{image.prompt}}" style="max-height:400px;width:auto;object-fit:contain;">
        {{/if}}
        <div class="card-body border mt-3">
          <h5 class="card-title">{{image.title}}</h5>
          <h5 class="card-prompt d-none">{{image.prompt}}</h5>
          <p class="card-text">{{image.comment}}</p>
          <p class="text-muted"><span class="jp-date">{{image.createdAt}}</span></p>
          <div class="d-flex justify-content-between align-items-center">
            <button class="btn btn-light shadow-0 image-fav {{#if  (includesObjectId image.likedBy user._id) }}liked{{/if}}" data-id="{{image._id}}">
              <i class="bi bi-heart-fill me-2"></i>{{translations.like}}<span class="ct d-none">{{default image.likes 0}}</span>
            </button>
            <a href="/chat/{{chat._id}}" class="btn btn-outline-secondary"> <i class="bi bi-chat-dots me-2"></i> {{translations.startChatting}}</a>
          </div>
        </div>
      </div>
    </div>
    {{/if}}
    {{#if chat}}
    <!-- Chat Profile Section -->
    <div class="col-lg-4 mb-4">
      <div class="card border shadow-0">
        <div class="card-body text-center">
          <div class="chat-profile mt-4">
            <div class="row mx-0 mb-3">
              <div id="chatProfileSection" class="text-center">
                <div class="mx-auto p-auto text-center d-flex align-items-center justify-content-center position-relative mb-2">
                  <a href="/chat/{{chat._id}}" class="text-secondary" style="text-decoration:none;">  
                    <img src="{{default chat.chatImageUrl '/img/avatar.png'}}" alt="Chat Thumbnail" class="rounded-circle" 
                    style="width: 100px; height: 100px; object-fit: cover; object-position: top;">
                  </a>
                </div>
                <a href="/chat/{{chat._id}}" class="text-secondary" style="text-decoration:none;">
                  <h2>{{chat.name}}</h2>
                </a>
                  <p>{{chat.description}}</p>
                <a href="/chat/{{chat._id}}" class="btn btn-outline-secondary"> <i class="bi bi-chat-dots me-2"></i>  {{translations.startChatting}}</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <h3 class="text-start">{{translations.user_in_chat}}</h3>
  <div class="container mt-4 mb-5">
    <!-- Chat Users Section -->
    <div id="chat-users-gallery" class="d-flex overflow-auto p-2" style="white-space: nowrap;"></div>
    <div id="chat-users-pagination-controls" class="mt-3"></div>
  </div>

  {{/if}}

  <!-- Other Images Section -->
  {{#if chatId}}
  <div class="container mb-5 px-0">
    <div class="row mx-0">
      <div class="col-12 mt-4 px-0">
        <h4>{{translations.other_images}}</h4>
        <hr>
        <div class="container-none">
          <div class="row mx-0" id="chat-images-gallery"></div>
          <div class="d-flex justify-content-center mt-4" id="chat-images-pagination-controls"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Update the modal HTML to include a close button, fullscreen, and arrows -->
<div class="modal fade" id="swiperModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-fullscreen">
    <div class="modal-content bg-dark">
      <div class="modal-header border-0 position-absolute" style="z-index: 99;">
        <button type="button" class="btn-close btn-close-white"  style="color: #f5f5f5;" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body p-0 d-flex align-items-center justify-content-center">
        <div class="swiper-container" style="width:100%;height:100%;">
          <div class="swiper-wrapper"></div>
          <div class="swiper-button-next swiper-button-white" style="color: #f5f5f5;"></div>
          <div class="swiper-button-prev swiper-button-white" style="color: #f5f5f5;"></div>
        </div>
      </div>
    </div>
  </div>
</div>

{{else}}
 <h1 class="my-4 text-center">{{translations.ai_gravure_special_photos}}</h1>
  <p>{{translations.ai_gravure_description}}</p>
   
  <div class="container mt-4 mb-5">
    <div class="row mx-0" id="all-chats-images-gallery"></div>
    <div class="d-flex justify-content-center mt-4" id="all-chats-images-pagination-controls"></div>
    <button id="back-to-top" style="display: none;">トップに戻る</button>
  </div>
{{/if}}
<style>
  footer{display: inline !important;}
  .sticky-bottom{display: inline-block !important;width: 100%;}
</style>
 {{> dashboard-footer}}


</body>

<script>
  $(document).ready(function () {
    const chatId =`{{chatId}}`
    if(chatId){
      loadChatImages(chatId, 1);
      loadChatUsers(chatId);
    }else{
      loadAllChatImages(1);
    }
  });
  </script>
</html>
