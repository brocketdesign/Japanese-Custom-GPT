<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="//code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>

<script src="/js/dashboard.js"></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/7.3.2/mdb.umd.min.js"
></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<script>
$(document).ready(function(){
    // Initialize user info from the Handlebars variable
    const user = {
        _id: "{{user._id}}",
        isTemporary: "{{user.isTemporary}}",
    };
    if(user.isTemporary == true){

    }else{
        updatePlanStatus(user)
    }
})

window.updatePlanStatus = function(user){
  $.get('/user/plan/'+user._id,function(data){
      let message = `<span class="ms-1">&#x1F381;</span>`;
      if(!data.plan){
        $('.user-current-plan').each(function(){
          $(this).html(message).show()
        })
        return
      }
      const billingCycle = data.plan.billingCycle
      const currentPlanId = data.plan.currentPlanId

      $.get('/plan/list',function(data){
          const plans = data.plans
          const plan = plans.find((plan) => plan[`${billingCycle}_id`] === currentPlanId);
          if(!plan){
            message = `<span class="ms-1">&#x1F381;</span>`;
          }else{
            switch (plan.id) {
              case 'free':
                message = `<span class="ms-1">&#x1F381;</span>`;
                break;
              case 'premium':
                message = `<span class="ms-1"> &#x1F48E;</span>`;
                break;
              case 'special':
                message = ` <span class="ms-1">&#x1F525;</span>`;
                break;
              default:
                message = `<span class="ms-1">&#x1F381;</span>`;
            }
          }
          $('.user-current-plan').each(function(){
            $(this).html(message).show()
          })
      })
  })
}
window.showNotification = function(message, icon) {
    Swal.fire({
        position: 'top-end',
        icon: icon,
        title: message,
        showConfirmButton: false,
        timer: 3000,
        toast: true,
        customClass: {
            title: 'swal2-custom-title',
            popup: 'swal2-custom-popup'
        },
        showClass: {
            popup: 'animate__animated animate__slideInRight'
        },
        hideClass: {
            popup: 'animate__animated animate__slideOutRight'
        }
    });
}
window.setApiUrlAndMode = async function() {
    let mode = localStorage.getItem('MODE');
    let API_URL = localStorage.getItem('API_URL');

    if (!mode || !API_URL) {
        mode = await fetchMode();
        API_URL = (mode !== 'local' && !window.location.origin.includes('lamix')) 
            ? 'https://app.lamix.jp' 
            : window.location.origin;

        localStorage.setItem('MODE', mode);
        localStorage.setItem('API_URL', API_URL);
    }

    return { API_URL, MODE: mode };
};

window.fetchUser = async function() {
    const { API_URL, MODE } = await window.setApiUrlAndMode();
    try {
        const response = await fetch(`${API_URL}/api/user`, { method: 'GET' });
        if (!response.ok) throw new Error('Network response was not ok');
        const data = await response.json();
        return data.user;
    } catch (error) {
        console.error('Error fetching user:', error);
        return null;
    }
};
window.fetchMode = async function() {
    try {
        const response = await fetch('/api/mode', { method: 'GET' });
        if (!response.ok) throw new Error('Network response was not ok');
        const data = await response.json();
        return data.mode;
    } catch (error) {
        console.error('Error fetching mode:', error);
        return null
    }
};

</script>

<footer class="l-footer p-footer bg-white shadow-0 text-center onchat-off ">
  <div class="container my-5 py-5">
    <div class="row">
      <div class="col-12">
        <nav class="navbar navbar-expand-lg navbar-light shadow-0 py-0 d-flex flex-column">
          <div class="row">
              <div class="d-flex justify-content-center">
                <a href="https://x.com/Lamix253843" target="_blank" class="btn btn-dark rounded text-center mb-2 mx-2">
                  <i class="bi bi-twitter-x"></i> 
                </a>
                <a href="https://www.instagram.com/aichat_lamix/" target="_blank" class="btn btn-dark rounded text-center mb-2 mx-2">
                  <i class="bi bi-instagram"></i>
                </a>
              </div>
            <p style="color: #555;">{{translations.contactUs}}</p>
          </div>
          <div class="container-fluid justify-content-center">
            <ul class="navbar-nav d-flex flex-row" style="flex-wrap: inherit;">
              <li class="nav-item m-1">
                <a class="nav-link" href="/about" target="_blank">{{translations.aboutService}}</a>
              </li>
              <li class="nav-item m-1">
                <a class="nav-link" href="https://lamix.jp/usage-policy/" target="_blank">{{translations.termsOfUse}}</a>
              </li>
              <li class="nav-item m-1">
                <a class="nav-link" href="https://lamix.jp/privacy-policy/" target="_blank">{{translations.privacyPolicy}}</a>
              </li>
              <li class="nav-item m-1">
                <a class="nav-link" href="https://lamix.jp/%e4%bc%9a%e7%a4%be%e6%a6%82%e8%a6%81/" target="_blank">{{translations.companyOverview}}</a>
              </li>
              <li class="nav-item m-1">
                <a class="nav-link" href="https://lamix.jp/%e3%83%96%e3%83%ad%e3%82%b0/" target="_blank">{{translations.blog}}</a>
              </li>
              <li class="nav-item m-1">
                <a class="nav-link" href="/character" target="_blank">{{translations.characters}}</a>
              </li>
            </ul>
          </div>
        </nav>
      </div>
      <div class="col-12">
        <nav class="navbar navbar-expand-lg navbar-light shadow-0 py-0 d-flex flex-column">
          <div class="container-fluid justify-content-center">
            <small class="p-footer__copyright" translate="no" lang="en">
              Copyright ©2024 <a href="https://hatoltd.com/" target="_blank">HATO,LTD.</a> All Rights Reserved.
            </small>
          </div>
          <div class="row mt-2">
            <!-- Language Dropdown -->
            <div class="dropdown">
              <button class="btn btn-secondary dropdown-toggle" type="button" id="languageDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                {{#if user.lang}}
                  {{capitalize user.lang}}
                {{else}}
                  日本語
                {{/if}}
              </button>
              <ul class="dropdown-menu" aria-labelledby="languageDropdown">
                <li><a class="dropdown-item language-select" href="#" data-lang="ja">日本語</a></li>
                <li><a class="dropdown-item language-select" href="#" data-lang="en">English</a></li>
              </ul>
            </div>
          </div>
        </nav>
      </div>
    </div>
  </div>
</footer>
