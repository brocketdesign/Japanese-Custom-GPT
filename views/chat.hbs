<!DOCTYPE html>
<html lang="{{user.lang}}">
    {{> dashboard-header}}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <link rel="stylesheet" href="/css/chat-suggestions.css">
    <link rel="stylesheet" href="/css/speech-to-text.css">
    <link rel="stylesheet" href="/css/chat-scenario.css">
    <link rel="stylesheet" href="/css/chat-goals-widget.css">
    <link rel="stylesheet" href="/css/chat-list-tabs.css">
    <link rel="stylesheet" href="/css/chat-history-sidebar.css">
<body>
    {{> onboarding-modals}}
    <!-- Fullscreen overlay with loading spinner -->
    <div class="fullscreen-overlay justify-content-center align-items-center" id="loadingOverlay">
        <div style="position: relative; display: flex; justify-content: center; align-items: center;"> <!-- Wrapper for logo and spinner -->
            <div class="loading-circle shadow" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <div style="z-index: 10;">
                <div class="brand-logo rounded-circle bg-white" style="width: 100px; height: 100px;background: white;">
                    <i class="bi bi-chat-heart-fill" style="font-size: 3em; color: #b58afe;"></i>
                </div>
            </div>
        </div>
    </div>
    <div id="swup-none">
        <div id="overlay" class="d-sm-none bg-dark" style="position: fixed; inset: 0; z-index: 1033; display: none; opacity: 0.4; overflow: hidden;"></div>
        <div class="content collapsed">
            <nav class="navbar navbar-expand-lg navbar-white bg-transparent fixed-top shadow-0 flex-column" style="z-index: 1020;">
                <div class="container-fluid">
                    <div class="d-flex align-items-center justify-content-center">
                        <div style="position: absolute;left: 20px;top: 10px;">
                            <button 
                            class="btn shadow-0 onchat-on goBackButton" 
                            style="display: none;"
                            onclick="showDiscovery()"><i class="bi bi-arrow-left"></i></button>

                            <div id="chat-actions-dropdown" class="dropdown d-inline-block onchat-on" style="display: none;">
                                <button class="btn shadow-0 dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="bi bi-three-dots-vertical"></i>
                                </button>
                                <ul class="dropdown-menu shadow border-0">
                                    <!-- Dropdown items will be populated by JavaScript -->
                                </ul>
                            </div>
                        </div>
                        <div class="d-flex flex-row " style="cursor: pointer; min-height: 40px;" onclick="showDiscovery()">
                            <div class="brand-logo me-3 onchat-off" style="display: flex; position: absolute; left: 10px;">
                                <i class="bi bi-chat-heart-fill text-white fs-3"></i>
                            </div>
                        </div>  
                        <div>
                            <div class="navbar-collapse" id="navbarNav" style="position: absolute;right: -50vw;top: 10px;">
                                <ul class="navbar-nav ms-auto flex-row mb-lg-0">
                                    {{> dashboard-avatar}}
                                </ul>
                            </div>
                        </div>   
                    </div>
                </div>
            {{> chat-header}}
            </nav>
            {{> chat-list}}
            <section id="chat-discovery" class="onchat-off" style="display: block; padding-top: 180px;">

                <!-- Premium user benefits - Native design matching chat-native.hbs -->
                <section class="native-section is-free-user d-none" id="premium-benefits-section" style="display: block;">
                    <div class="native-section-header">
                        <h2 class="native-section-title">
                            <i class="native-section-icon bi bi-star-fill" style="color: #FFD700;"></i>
                            {{#if translations.premiumBenefits}}{{translations.premiumBenefits}}{{else}}Premium Features{{/if}}
                        </h2>
                    </div>
                    <div class="native-section-content">
                        <div class="native-benefits-grid">
                            <!-- Benefit 1 -->
                            <div class="native-benefit-card">
                                <i class="native-benefit-icon bi bi-images"></i>
                                <h3 class="native-benefit-title">{{#if translations.premiumUserBenefits.benefit1.title}}{{translations.premiumUserBenefits.benefit1.title}}{{else}}Unlimited Photos{{/if}}</h3>
                                <p class="native-benefit-description">{{#if translations.premiumUserBenefits.benefit1.description}}{{translations.premiumUserBenefits.benefit1.description}}{{else}}Create and share unlimited photos{{/if}}</p>
                            </div>
                            <!-- Benefit 2 -->
                            <div class="native-benefit-card">
                                <i class="native-benefit-icon bi bi-gift"></i>
                                <h3 class="native-benefit-title">{{#if translations.premiumUserBenefits.benefit2.title}}{{translations.premiumUserBenefits.benefit2.title}}{{else}}Exclusive Gifts{{/if}}</h3>
                                <p class="native-benefit-description">{{#if translations.premiumUserBenefits.benefit2.description}}{{translations.premiumUserBenefits.benefit2.description}}{{else}}Access exclusive gift items{{/if}}</p>
                            </div>
                            <!-- Benefit 3 -->
                            <div class="native-benefit-card">
                                <i class="native-benefit-icon bi bi-fire"></i>
                                <h3 class="native-benefit-title">{{#if translations.premiumUserBenefits.benefit3.title}}{{translations.premiumUserBenefits.benefit3.title}}{{else}}NSFW Access{{/if}}</h3>
                                <p class="native-benefit-description">{{#if translations.premiumUserBenefits.benefit3.description}}{{translations.premiumUserBenefits.benefit3.description}}{{else}}Access to all NSFW content{{/if}}</p>
                            </div>
                            <!-- Benefit 4 -->
                            <div class="native-benefit-card">
                                <i class="native-benefit-icon bi bi-sliders"></i>
                                <h3 class="native-benefit-title">{{#if translations.premiumUserBenefits.benefit4.title}}{{translations.premiumUserBenefits.benefit4.title}}{{else}}Unlock All Chat Custom Features{{/if}}</h3>
                                <p class="native-benefit-description">{{#if translations.premiumUserBenefits.benefit4.description}}{{translations.premiumUserBenefits.benefit4.description}}{{else}}Access all character customization and chat tool options{{/if}}</p>
                            </div>
                            <!-- Benefit 5 -->
                            <div class="native-benefit-card">
                                <i class="native-benefit-icon bi bi-film"></i>
                                <h3 class="native-benefit-title">{{#if translations.premiumUserBenefits.benefit5.title}}{{translations.premiumUserBenefits.benefit5.title}}{{else}}Video Generation{{/if}}</h3>
                                <p class="native-benefit-description">{{#if translations.premiumUserBenefits.benefit5.description}}{{translations.premiumUserBenefits.benefit5.description}}{{else}}Generate custom videos from your AI characters{{/if}}</p>
                            </div>
                        </div>
                        <!-- Premium CTA Button -->
                        <div class="text-center mt-4">
                            <button class="btn btn-primary btn-lg fw-bold" onclick="loadPlanPage()" style="background: linear-gradient(135deg, #0066cc 0%, #0052a3 100%); border: none; padding: 12px 40px; border-radius: 30px; font-size: 16px; transition: all 0.3s ease;">
                                <i class="bi bi-crown-fill me-2"></i>{{#if translations.upgradeNow}}{{translations.upgradeNow}}{{else}}Upgrade to Premium{{/if}}
                            </button>
                        </div>
                    </div>
                </section>

                
                <!-- Card menu -->
                <div class="card-menu-container native-section mb-3 px-0 d-none">
                    <div class="native-section-header">
                        <h2 class="native-section-title">
                            <i class="native-section-icon bi bi-rocket-fill" style="color: #FF8C00;"></i>
                            {{#if translations.startHere}}{{translations.startHere}}{{else}}Start Here{{/if}}
                        </h2>
                    </div>
                    <div class="native-section-content">
                        <div class="native-benefits-grid">
                            <!-- Create Character Card -->
                            <div class="native-benefit-card card-menu-item" onclick="loadCharacterCreationPage()" style="cursor: pointer;">
                                <div class="rounded-circle mx-auto mb-2 d-flex align-items-center justify-content-center" 
                                     style="width: 60px; height: 60px; background-color: #e7f5ff;">
                                    <i class="bi bi-plus-lg" style="font-size: 1.8em; color: #0066cc;"></i>
                                </div>
                                <h3 class="native-benefit-title">{{translations.createCharacter}}</h3>
                                <p class="native-benefit-description">{{translations.createCharacterDescription}}</p>
                                <!-- Restrictions -->
                                <div class="rounded-pill text-white fw-bold mt-2 py-1 px-2 is-free-user" style="font-size: 11px; background: color(srgb 0.489 0.223 0.9696); display: inline-block;" role="alert">
                                    {{translations.createCharacterRestriction}}
                                </div>
                            </div>
                            
                            <!-- Explore Characters Card -->
                            <div class="native-benefit-card card-menu-item" onclick="window.location.href='/search'" style="cursor: pointer;">
                                <div class="rounded-circle mx-auto mb-2 d-flex align-items-center justify-content-center" 
                                     style="width: 60px; height: 60px; background-color: #f0fdf4;">
                                    <i class="bi bi-globe" style="font-size: 1.8em; color: #16a34a;"></i>
                                </div>
                                <h3 class="native-benefit-title">{{translations.explore}}</h3>
                                <p class="native-benefit-description">{{translations.exploreDescription}}</p>
                                <div class="rounded-pill text-white fw-bold mt-2 py-1 px-2 is-free-user" style="font-size: 11px; background: color(srgb 0.489 0.223 0.9696); display: inline-block;" role="alert">
                                    {{translations.exploreRestriction}}
                                </div>
                            </div>
                            
                            <!-- User Profile Card -->
                            <div class="native-benefit-card card-menu-item" onclick="window.location.href='/user/{{user._id}}'" style="cursor: pointer;">
                                <div class="rounded-circle mx-auto mb-2 d-flex align-items-center justify-content-center" 
                                     style="width: 60px; height: 60px; background-color: #ecf9ff;">
                                    <i class="bi bi-person" style="font-size: 1.8em; color: #0891b2;"></i>
                                </div>
                                <h3 class="native-benefit-title">{{translations.userProfile}}</h3>
                                <p class="native-benefit-description">{{translations.userProfileDescription}}</p>
                                <div class="rounded-pill text-white fw-bold mt-2 py-1 px-2 is-free-user" style="font-size: 11px; background: color(srgb 0.489 0.223 0.9696); display: inline-block;" role="alert">
                                    {{translations.userRestriction}}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sorting Tools: Premium/Free, Gender & NSFW Filters (Responsive) -->
                <div class="mx-4 sorting-tools mb-3">
                    <div class="row g-3 align-items-center">

                        <!-- [DISABLE] Gender Filter Buttons -->
                        <div class="col-12 col-md d-flex align-items-center gap-2 flex-wrap justify-content-between justify-content-md-start">
                            <span class="me-2 text-muted" style="font-size: 15px;">
                                <i class="bi bi-gender-ambiguous"></i> {{translations.sort.genderLabel}}
                            </span>
                            <div class="d-flex flex-wrap gap-2">
                                <button id="popular-chats-gender-female" class="btn btn-outline-primary px-3 py-1" style="border-radius: 30px; font-size: 14px;">
                                    <i class="bi bi-gender-female me-1"></i>{{translations.sort.female}}
                                </button>
                                <button id="popular-chats-gender-male" class="btn btn-outline-info px-3 py-1" style="border-radius: 30px; font-size: 14px;">
                                    <i class="bi bi-gender-male me-1"></i>{{translations.sort.male}}
                                </button>
                                <button id="popular-chats-gender-nonbinary" class="btn btn-outline-success px-3 py-1" style="border-radius: 30px; font-size: 14px;">
                                    <i class="bi bi-gender-trans me-1"></i>{{translations.sort.nonBinary}}
                                </button>
                            </div>
                        </div>

                        <!-- Category cards -->
                        <div class="container-fluid mb-4 native-section d-none">
                            <h2 class="native-section-title mb-3">
                                <i class="native-section-icon bi bi-grid-3x3-gap" style="color: #40BFF2;"></i>
                                {{#if translations.allCategories}}{{translations.allCategories}}{{else}}All Categories{{/if}}
                            </h2>
                            <div class="row" id="category-cards-container-none">
                                <!-- Loading placeholder -->
                                <div class="col-12 text-center">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading categories...</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Query Tags Horizontal Scroll Section -->
                        <div class="query-tags-section mb-1 native-section">
                            <div class="native-section-header">
                                <h2 class="native-section-title">
                                    <i class="native-section-icon bi bi-tags" style="color: #4080FF;"></i>
                                    {{translations.browseByCategory}}
                                </h2>
                                <button class="native-section-action" onclick="resetPopularChatCache()" title="Reset categories cache">
                                    <i class="bi bi-arrow-counterclockwise"></i>
                                </button>
                            </div>

                            <!-- Action button section #reload-latest-chats -->
                            <div class="col-12 col-md-auto d-flex justify-content-center justify-content-md-start mx-3">
                                <button id="reload-latest-chats" class="btn-flat-border btn-outline-primary" style="border: none!important;
background-color: color(srgb 0.5022 0.2316 0.965 / 0.2) !important;">
                                    <i class="bi bi-arrow-clockwise me-1"></i>{{#if translations.recent}}{{translations.recent}}{{else}}Recent{{/if}}
                                </button>
                                <button id="reload-latest-video-chats" class="btn-flat-border btn-outline-primary ms-2" style="border: none!important;
background-color: color(srgb 0.5022 0.2316 0.965 / 0.2) !important;">
                                    <i class="bi bi-film me-1"></i>{{#if translations.recentVideos}}{{translations.recentVideos}}{{else}}Recent Videos{{/if}}
                                </button>
                            </div>
                            <div class="query-tags-scroll-container mx-3">
                                <div class="query-tags-list d-flex" id="query-tags-list">
                                    <!-- Query tags will be populated here -->
                                    <div class="spinner-border spinner-border-sm me-3" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Popular chats section -->
                <div id="popular-chats-section">
                    <div id="all-chats-container" class="row g-3 all-chats-gallery mx-0"></div>
                    <div class="row mx-0" id="all-chats-images-gallery"></div>
                    <div class="d-flex justify-content-center mt-4" id="all-chats-images-pagination-controls"></div>
                    
                    <div id="latest-chats-gallery" class="row latest-chats-gallery mx-0"></div>

                    <div id="latest-video-chats-gallery" class="row pb-3 px-3 mx-0"></div>
                    <div id="latest-video-chats-pagination-controls" class="text-center mt-3"></div>

                    <div id="chat-gallery" class="row g-3 popular-chats-gallery mx-0"></div>
                    <div id="popular-chats-pagination-controls" class="my-3" style="opacity: 0;"></div>
                </div>
            </section>
            <div id="chat-wrapper" class="px-0 onchat-on" style="background-position: top center;background-repeat: no-repeat;background-size:cover;position: relative;">
                <!-- Chat Container Overlay -->
                <div id="chat-container" class="container mx-auto shadow-0 border-0 rounded-0" style="border-radius:0 !important;position: relative;">
                    <div class="chat-overlay d-flex justify-content-center align-items-center w-100 h-100vh position-absolute top-0 start-0 bottom-0" id="chatOverlay" style="background-color: #ffffff!important;opacity: 0.85;"></div>
                    
                    <div class="card-body text-center p-0 container" style="min-height:250px;overflow-y:hidden;display: flex;flex-direction: column;position: relative;z-index: 990;">
                        <!-- Chat Scenarios Container - positioned absolutely but within chat wrapper to avoid toolbar overlap -->
                        <div class="scenario-container"></div>
                        <div id="chatContainer" data-id="" class="pt-2 fade-content" style="padding-bottom: 180px !important;"></div>
                    </div>
                </div>  
            </div>  
        </div>
    </div>
 {{> dashboard-footer}}

    <script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.19.0/js/md5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="/js/merge-face.js"></script>
    <script src="/js/txt2speech.js"></script>
    <script src="/js/dashboard-category.js"></script>
    <script src="/js/chat-tool-swiper.js"></script>
    <script src="/js/chat-tool-toolbar.js"></script>
    <script src="/js/chat-list.js"></script>
    <script src="/js/favorites.js"></script>
    <script src="/js/chat-tool-prompts.js"></script>
    <script src="/js/chat-tool-gifts.js"></script>
    <script src="/js/chat-tool-settings.js"></script>
    <script src="/js/chat-tool-message.js"></script>
    <script src="/js/chat-tool-goals.js"></script>
    <script src="/js/chat-suggestions.js"></script>
    <script src="/js/chat-scenario.js"></script>
    <script src="/js/chat-footer.js"></script>
    <script src="/js/live-goals-widget.js"></script>
    <script src="/js/chat.js"></script>
    <script src="/js/character-infos.js"></script>
    <script src="/js/img2video.js"></script>
    <script src="/js/speech-to-text-init.js"></script>
    <script src="/js/speech-to-text-ui.js"></script>
    <script src="/js/speech-to-text-utils.js"></script>

    <!-- Modularized scripts extracted from inline block -->
    <script src="/js/modules/layout-adjustments.js"></script>
    <script src="/js/modules/iframe-communication.js"></script>
    <script src="/js/modules/chat-history.js"></script>
    <script src="/js/modules/popular-chats.js"></script>
    <script src="/js/modules/latest-chats.js"></script>
    <script src="/js/modules/chat-filters.js"></script>
    <script src="/js/modules/ui-helpers.js"></script>
    <script src="/js/modules/checkout.js"></script>
    <script src="/js/modules/init.js"></script>

</body>
</html>