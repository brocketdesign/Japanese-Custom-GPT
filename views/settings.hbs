<h2 class="h3 mb-4 page-title d-none">{{translations.setting.pageTitle}}</h2>
<div class="my-4">

  <!-- Tab content -->
  <div class="tab-content" id="myTabContent">
          <!-- Profile Tab -->
          <div class="tab-pane fade show active" id="profile" role="tabpanel" aria-labelledby="profile-tab">
            <!-- User Info Form -->
            <form id="user-info-form" class="settings-form shadow-0">
              
              <!-- Profile Picture Section -->
              <div class="settings-section">
                <div class="settings-section-header mb-4">
                  <h5 class="settings-section-title mb-1">
                    <i class="bi bi-person-circle me-2 text-primary"></i>
                    {{translations.setting.profilePicture}}
                  </h5>
                  <p class="settings-section-subtitle text-muted mb-0">
                    {{translations.setting.profilePictureDescription}}
                  </p>
                </div>
                
                <div class="row">
                  <div class="col-12">
                    <div id="profileSection" data-user-id="{{userData._id}}" class="profile-picture-container">
                      <div class="profile-picture-wrapper">
                        <img id="profileImage" src="/img/avatar.png" alt="Profile Picture" class="profile-image">
                        <div class="profile-picture-overlay">
                          <i class="bi bi-camera-fill"></i>
                          <span>{{translations.setting.changePhoto}}</span>
                        </div>
                      </div>
                      
                      <!-- Image Moderation Warning -->
                      <div class="alert alert-warning mt-3" role="alert" id="imageModerationFlagged" style="display: none;">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        {{translations.setting.imageModerationFlagged}}
                      </div>
                    </div>
                    
                    <div class="mb-3 mt-3" id="thumbnailInputContainer" style="display: none;">
                      <input type="file" class="form-control" id="profileImageInput" name="profileImageInput" accept="image/*">
                    </div>
                  </div>
                </div>
              </div>
              <!-- Personal Information Section -->
              <div class="settings-section">
                <div class="settings-section-header mb-4">
                  <h5 class="settings-section-title mb-1">
                    <i class="bi bi-person-lines-fill me-2 text-primary"></i>
                    {{translations.setting.personalInformation}}
                  </h5>
                  <p class="settings-section-subtitle text-muted mb-0">
                    {{translations.setting.personalInformationDescription}}
                  </p>
                </div>

                <div class="row g-3">
                  <div class="col-md-6">
                    <div class="form-floating">
                      <input type="text" id="nickname" class="form-control" placeholder="{{translations.setting.nickname}}" />
                      <label for="nickname">
                        <i class="bi bi-person me-1"></i>
                        {{translations.setting.nickname}}
                      </label>
                    </div>
                  </div>

                  <div class="col-md-6">
                    <div class="form-floating">
                      <input type="email" class="form-control" id="inputEmail4" placeholder="{{translations.setting.email}}" />
                      <label for="inputEmail4">
                        <i class="bi bi-envelope me-1"></i>
                        {{translations.setting.email}}
                      </label>
                    </div>
                  </div>

                  <!-- Age Range Display -->
                  <div class="col-md-6" id="ageRangeSection" style="display: none;">
                    <div class="form-control h-auto py-3 bg-light">
                      <div class="d-flex align-items-center">
                        <i class="bi bi-calendar-range me-2 text-muted"></i>
                        <div>
                          <small class="text-muted d-block">{{translations.setting.ageRange}}</small>
                          <span class="fw-semibold" id="userAgeRange"></span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="col-md-6">
                    <div class="form-floating">
                      <select class="form-select" id="gender" name="gender">
                        <option value="female" selected>{{translations.setting.female}}</option>
                        <option value="male">{{translations.setting.male}}</option>
                      </select>
                      <label for="gender">
                        <i class="bi bi-gender-ambiguous me-1"></i>
                        {{translations.setting.gender}}
                      </label>
                    </div>
                  </div>

                  <div class="col-md-6">
                    <div class="settings-field">
                      <label class="form-label mb-2">
                        <i class="bi bi-globe2 me-1"></i>
                        {{translations.setting.language}}
                      </label>
                      <div class="dropdown w-100">
                        <button data-user-lang="{{user.lang}}" class="btn btn-outline-secondary dropdown-toggle w-100 text-start" type="button" id="languageDropdownMenu" data-bs-toggle="dropdown" aria-expanded="false">
                          <i class="bi bi-globe2 me-2"></i>
                          <span class="language-text">{{translations.setting.selectLanguage}}</span>
                        </button>
                        <ul class="dropdown-menu w-100" aria-labelledby="languageDropdownMenu">
                          <li><a class="dropdown-item language-select" href="#" data-lang="ja">
                            <i class="bi bi-flag me-2"></i>{{translations.setting.japanese}}
                          </a></li>
                          <li><a class="dropdown-item language-select" href="#" data-lang="en">
                            <i class="bi bi-flag me-2"></i>{{translations.setting.english}}
                          </a></li>
                          <li><a class="dropdown-item language-select" href="#" data-lang="fr">
                            <i class="bi bi-flag me-2"></i>{{translations.setting.french}}
                          </a></li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- Content Preferences Section -->
              <div class="settings-section">
                <div class="settings-section-header mb-4">
                  <h5 class="settings-section-title mb-1">
                    <i class="bi bi-sliders me-2 text-primary"></i>
                    {{translations.setting.contentPreferences}}
                  </h5>
                  <p class="settings-section-subtitle text-muted mb-0">
                    {{translations.setting.contentPreferencesDescription}}
                  </p>
                </div>

                <!-- NSFW Toggle -->
                <div class="settings-preference-item">
                  <div class="d-flex align-items-start justify-content-between">
                    <div class="preference-info">
                      <div class="preference-title">
                        <i class="bi bi-eye me-2"></i>
                        {{translations.setting.showNSFW}}
                        <i class="bi bi-crown-fill premium-icon ms-1 text-warning" id="nsfw-premium-icon" style="display: none;"></i>
                      </div>
                      <div class="preference-description text-muted">
                        {{translations.setting.showNSFWDescription}}
                      </div>
                      <div id="nsfw-premium-indicator" class="premium-feature-indicator mt-2" style="display: none;">
                        <small class="text-warning d-flex align-items-center">
                          <i class="bi bi-star-fill me-1"></i> 
                          Premium feature required to view adult content
                        </small>
                      </div>
                    </div>
                    <div class="preference-control">
                      <label class="settings-switch">
                        <input type="checkbox" id="nsfw-toggle">
                        <span class="settings-switch-slider"></span>
                      </label>
                    </div>
                  </div>
                </div>
              </div>
              <!-- About You Section -->
              <div class="settings-section">
                <div class="settings-section-header mb-4">
                  <h5 class="settings-section-title mb-1">
                    <i class="bi bi-chat-quote me-2 text-primary"></i>
                    {{translations.setting.aboutYou}}
                  </h5>
                  <p class="settings-section-subtitle text-muted mb-0">
                    {{translations.setting.aboutYouDescription}}
                  </p>
                </div>

                <div class="form-floating">
                  <textarea class="form-control bio-textarea" id="bio" name="bio" rows="5" maxlength="400" placeholder="{{translations.setting.bioPlaceholder}}"></textarea>
                  <label for="bio">
                    <i class="bi bi-chat-quote me-1"></i>
                    {{translations.setting.bio}}
                  </label>
                  <div class="form-text mt-2">
                    <div class="d-flex justify-content-between">
                      <span>{{translations.setting.bioHint}}</span>
                      <span class="character-count text-muted">
                        <span id="bio-char-count">0</span>/400
                      </span>
                    </div>
                  </div>
                </div>
              </div>

              {{#if isAdmin}}
              <!-- Advanced Settings Section -->
              <div class="settings-section">
                <div class="settings-section-header mb-4">
                  <h5 class="settings-section-title mb-1">
                    <i class="bi bi-gear me-2 text-primary"></i>
                    {{translations.setting.advancedSettings}}
                  </h5>
                  <p class="settings-section-subtitle text-muted mb-0">
                    {{translations.setting.advancedSettingsDescription}}
                  </p>
                </div>
                
                <div class="advanced-setting-card">
                  <div class="d-flex justify-content-between align-items-center">
                    <div class="advanced-setting-info">
                      <div class="advanced-setting-title">
                        <i class="bi bi-arrow-clockwise me-2"></i>
                        {{translations.restartOnboarding}}
                      </div>
                      <div class="advanced-setting-description text-muted">
                        {{translations.restartOnboardingDesc}}
                      </div>
                    </div>
                    <button type="button" id="restart-onboarding" class="btn btn-outline-primary btn-sm">
                      <i class="bi bi-arrow-clockwise me-1"></i> 
                      {{translations.restart}}
                    </button>
                  </div>
                </div>
              </div>
              {{/if}}

            </form>
          </div>

          <!-- Password Tab -->
          <div class="tab-pane fade" id="password" role="tabpanel" aria-labelledby="password-tab">
            <h6>{{translations.setting.password}}</h6>
            <form id="user-password-form">
              <div class="row mb-4">
                <div class="col-md-6">
                  <div class="form-group">
                    <label for="inputPassword4">{{translations.setting.oldPassword}}</label>
                    <input type="password" class="form-control" id="inputPassword4" />
                  </div>
                  <div class="form-group">
                    <label for="inputPassword5">{{translations.setting.newPassword}}</label>
                    <input type="password" class="form-control" id="inputPassword5" />
                  </div>
                  <div class="form-group">
                    <label for="inputPassword6">{{translations.setting.confirmPassword}}</label>
                    <input type="password" class="form-control" id="inputPassword6" />
                  </div>
                </div>
                <div class="col-md-6">
                  <p class="mb-2">{{translations.setting.requirements}}</p>
                  <p class="small text-muted mb-2">{{translations.setting.requirementsDescription}}</p>
                  <ul class="small text-muted pl-4 mb-0">
                    <li>{{translations.setting.minLength}}</li>
                    <li>{{translations.setting.specialChar}}</li>
                    <li>{{translations.setting.number}}</li>
                    <li>{{translations.setting.differentPassword}}</li>
                  </ul>
                </div>
              </div>
              <button type="submit" class="btn btn-secondary">{{translations.setting.changePassword}}</button>
            </form>
          </div>

          <!-- Subscription Tab -->
          <div class="tab-pane fade" id="subscription" role="tabpanel" aria-labelledby="subscription-tab">
            <div class="settings-form shadow-0">
              <p id="user-plan" style="display: none;"></p>
              <button id="cancel-plan" class="btn btn-outline-danger btn-sm rounded-pill" style="display: none;position: absolute; bottom: 20px;font-size: 10px;opacity: 0.5;" data-user-id="{{user._id}}">{{translations.setting.cancelSubscription}}</button>
            
              <!-- Day Pass Countdown Section -->
              <div id="day-pass-countdown-section" class="text-center p-3 border rounded shadow-sm mt-3" style="display: none;">
                <h4 class="mb-3"><i class="bi bi-clock-history me-2"></i>{{translations.setting.dayPassActiveTitle}}</h4>
                <p class="lead">{{translations.setting.dayPassExpiresIn}}</p>
                <div id="countdown-timer" class="display-4 fw-bold text-primary mb-3">
                  <span id="hours">00</span>:<span id="minutes">00</span>:<span id="seconds">00</span>
                </div>
                <p id="day-pass-expired-message" class="text-danger mt-2" style="display: none;">
                  {{translations.setting.dayPassExpired}} <br>
                  <button class="btn custom-gradient-bg mt-2" onclick="loadPlanPage()">{{translations.select_plan_here}}</button>
                </p>
              </div>
              <!-- End Day Pass Countdown Section -->
            </div>
          </div>

          <!-- Usage Tab -->
          <div class="tab-pane fade" id="usage" role="tabpanel" aria-labelledby="usage-tab">
            <h6>{{translations.setting.usage}}</h6>
            <div id="user-limit"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
/* Compact Native App Style Settings */
.settings-form {
  border-radius: 0;
  padding: 0;
  box-shadow: none;
  background: transparent;
}

.settings-section {
  margin-bottom: 24px;
  padding-bottom: 20px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.settings-section:last-child {
  border-bottom: none;
  margin-bottom: 0;
  padding-bottom: 0;
}

.settings-section-header {
  padding-bottom: 0;
  margin-bottom: 12px;
}

.settings-section-title {
  font-weight: 600;
  color: rgba(255, 255, 255, 0.95);
  font-size: 15px;
  margin-bottom: 4px;
  letter-spacing: -0.1px;
}

.settings-section-title i {
  margin-right: 8px;
  font-size: 16px;
}

.settings-section-subtitle {
  font-size: 13px;
  line-height: 1.4;
  color: rgba(255, 255, 255, 0.75);
  margin-top: 4px;
}

.settings-divider {
  display: none;
}

.profile-picture-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-bottom: 16px;
}

.profile-picture-wrapper {
  position: relative;
  width: 100px;
  height: 100px;
  border-radius: 50%;
  overflow: hidden;
  cursor: pointer;
  transition: all 0.2s ease;
  border: 3px solid #f0f0f0;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.profile-picture-wrapper:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.12);
}

.profile-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  object-position: top;
}

.profile-picture-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.6);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  color: white;
  opacity: 0;
  transition: opacity 0.2s ease;
  font-size: 12px;
}

.profile-picture-wrapper:hover .profile-picture-overlay {
  opacity: 1;
}

.profile-picture-overlay i {
  font-size: 20px;
  margin-bottom: 4px;
}

.settings-preference-item {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 10px;
  padding: 12px 16px;
  border: 1px solid rgba(130, 64, 255, 0.2);
}

.preference-title {
  font-weight: 500;
  color: rgba(255, 255, 255, 0.9);
  margin-bottom: 4px;
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 6px;
}

.preference-description {
  font-size: 12px;
  line-height: 1.4;
  color: rgba(255, 255, 255, 0.75);
  margin-top: 2px;
}

.settings-switch {
  position: relative;
  display: inline-block;
  width: 44px;
  height: 26px;
  flex-shrink: 0;
}

.settings-switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.settings-switch-slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #d1d5db;
  transition: .2s;
  border-radius: 26px;
}

.settings-switch-slider:before {
  position: absolute;
  content: "";
  height: 20px;
  width: 20px;
  left: 3px;
  bottom: 3px;
  background-color: white;
  transition: .2s;
  border-radius: 50%;
  box-shadow: 0 1px 3px rgba(0,0,0,0.2);
}

.settings-switch input:checked + .settings-switch-slider {
  background-color: #6E20F4;
}

.settings-switch input:checked + .settings-switch-slider:before {
  transform: translateX(18px);
}

.settings-switch.disabled {
  opacity: 0.5;
  pointer-events: none;
}

.bio-textarea {
  resize: vertical;
  min-height: 100px;
  font-size: 14px;
  border-radius: 10px;
}

.character-count {
  font-size: 12px;
}

.advanced-setting-card {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 10px;
  padding: 12px 16px;
  border: 1px solid rgba(130, 64, 255, 0.2);
}

.advanced-setting-title {
  font-weight: 500;
  color: rgba(255, 255, 255, 0.9);
  margin-bottom: 4px;
  font-size: 14px;
}

.advanced-setting-description {
  font-size: 12px;
  color: rgba(255, 255, 255, 0.75);
}

.settings-form-actions {
  padding-top: 16px;
  border-top: 1px solid rgba(0, 0, 0, 0.08);
  margin-top: 20px;
}

.premium-feature-indicator {
  background: #fff3cd;
  border: 1px solid #ffeaa7;
  border-radius: 8px;
  padding: 8px 12px;
  font-size: 12px;
}

/* Form Elements - Compact */
.form-floating {
  margin-bottom: 16px;
}

.form-floating > label {
  font-size: 14px;
  padding: 0.75rem 0.75rem;
  color: rgba(255, 255, 255, 0.8);
}

.form-floating > .form-control,
.form-floating > .form-select {
  font-size: 14px;
  padding: 0.75rem 0.75rem;
  height: calc(3rem + 2px);
  border-radius: 10px;
  border: 1px solid rgba(130, 64, 255, 0.2);
  background: rgba(255, 255, 255, 0.1);
  color: rgba(255, 255, 255, 0.9);
}

/* Form-select specific styling for dropdown arrow and appearance */
.form-floating > .form-select {
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23ffffff' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m2 5 6 6 6-6'/%3e%3c/svg%3e");
  background-repeat: no-repeat;
  background-position: right 0.75rem center;
  background-size: 16px 12px;
  padding-right: 2.5rem;
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
}

.form-floating > .form-select:focus {
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23D2B8FF' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m2 5 6 6 6-6'/%3e%3c/svg%3e");
}

/* Ensure options have proper styling */
.form-floating > .form-select option {
  background: #2d2d2d;
  color: rgba(255, 255, 255, 0.9);
  padding: 0.5rem;
}

.form-floating > .form-control:focus,
.form-floating > .form-select:focus {
  border-color: #6E20F4;
  box-shadow: 0 0 0 3px rgba(110, 32, 244, 0.2);
  background: rgba(255, 255, 255, 0.1);
  color: rgba(255, 255, 255, 0.9);
}

.row.g-3 {
  --bs-gutter-y: 0.75rem;
  --bs-gutter-x: 0.75rem;
}

/* Ensure text-muted elements have better contrast in settings modal */
#settingsModal .text-muted,
.settings-modal .text-muted,
.settings-form .text-muted {
  color: rgba(255, 255, 255, 0.7) !important;
}

/* Form labels in settings */
.settings-form .form-label,
.settings-form label {
  color: rgba(255, 255, 255, 0.85) !important;
}

@media (max-width: 768px) {
  .settings-form {
    padding: 0;
  }
  
  .profile-picture-wrapper {
    width: 90px;
    height: 90px;
  }
  
  .settings-section-title {
    font-size: 14px;
  }
  
  .settings-section {
    margin-bottom: 20px;
    padding-bottom: 16px;
  }
}
</style>

<script>
// Character count for bio
document.addEventListener('DOMContentLoaded', function() {
  const bioTextarea = document.getElementById('bio');
  const charCount = document.getElementById('bio-char-count');
  
  if (bioTextarea && charCount) {
    function updateCharCount() {
      const count = bioTextarea.value.length;
      charCount.textContent = count;
      
      if (count > 350) {
        charCount.style.color = '#dc3545';
      } else if (count > 300) {
        charCount.style.color = '#ffc107';
      } else {
        charCount.style.color = '#6c757d';
      }
    }
    
    bioTextarea.addEventListener('input', updateCharCount);
    updateCharCount(); // Initial count
  }
});
</script>

</body>
</html>
