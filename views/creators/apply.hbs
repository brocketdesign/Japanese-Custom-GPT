<!DOCTYPE html>
<html lang="{{lang}}">
{{> dashboard-header}}
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="/css/creators.css">
    <title>{{title}}</title>
</head>
<body>
    {{> dashboard-nav}}

    <div id="swup" class="creator-apply-page">
        <!-- Header -->
        <section class="apply-hero">
            <div class="hero-content">
                <div class="hero-icon">
                    <i class="bi bi-rocket-takeoff"></i>
                </div>
                <h1 class="hero-title">{{creatorTranslations.applyHeroTitle}}</h1>
                <p class="hero-subtitle">{{creatorTranslations.applyHeroSubtitle}}</p>
            </div>
        </section>

        {{#unless isPremium}}
        <!-- Premium Required Alert -->
        <section class="premium-required-section">
            <div class="premium-required-card">
                <div class="premium-icon">
                    <i class="bi bi-gem"></i>
                </div>
                <h3>{{creatorTranslations.premiumRequiredTitle}}</h3>
                <p>{{creatorTranslations.premiumRequiredDesc}}</p>
                <a href="#" onclick="loadPlanPage()" class="upgrade-btn">
                    <i class="bi bi-star-fill me-2"></i>
                    {{creatorTranslations.upgradeToPremium}}
                </a>
            </div>
        </section>
        {{/unless}}

        <!-- Benefits Section -->
        <section class="benefits-section">
            <div class="benefits-grid">
                <div class="benefit-card">
                    <div class="benefit-icon">
                        <i class="bi bi-people-fill"></i>
                    </div>
                    <h3>{{creatorTranslations.benefitBuildAudience}}</h3>
                    <p>{{creatorTranslations.benefitBuildAudienceDesc}}</p>
                </div>
                <div class="benefit-card">
                    <div class="benefit-icon">
                        <i class="bi bi-currency-dollar"></i>
                    </div>
                    <h3>{{creatorTranslations.benefitEarnMoney}}</h3>
                    <p>{{creatorTranslations.benefitEarnMoneyDesc}}</p>
                </div>
                <div class="benefit-card">
                    <div class="benefit-icon">
                        <i class="bi bi-graph-up-arrow"></i>
                    </div>
                    <h3>{{creatorTranslations.benefitGrowBrand}}</h3>
                    <p>{{creatorTranslations.benefitGrowBrandDesc}}</p>
                </div>
                <div class="benefit-card">
                    <div class="benefit-icon">
                        <i class="bi bi-tools"></i>
                    </div>
                    <h3>{{creatorTranslations.benefitCreatorTools}}</h3>
                    <p>{{creatorTranslations.benefitCreatorToolsDesc}}</p>
                </div>
            </div>
        </section>

        <!-- Application Form -->
        {{#if isPremium}}
        <section class="application-section">
            <div class="form-container">
                <h2 class="form-title">
                    <i class="bi bi-pencil-square me-2"></i>
                    {{creatorTranslations.applicationForm}}
                </h2>

                <form id="creatorApplicationForm" class="creator-form">
                    <!-- Display Name -->
                    <div class="form-group">
                        <label for="displayName" class="form-label">
                            <i class="bi bi-person-badge me-1"></i>
                            {{creatorTranslations.displayName}}
                            <span class="required">*</span>
                        </label>
                        <input type="text" 
                               id="displayName" 
                               name="displayName" 
                               class="form-input"
                               value="{{user.nickname}}"
                               placeholder="{{creatorTranslations.displayNamePlaceholder}}"
                               required
                               minlength="2"
                               maxlength="50">
                        <span class="form-hint">{{creatorTranslations.displayNameHint}}</span>
                    </div>

                    <!-- Bio -->
                    <div class="form-group">
                        <label for="bio" class="form-label">
                            <i class="bi bi-chat-quote me-1"></i>
                            {{creatorTranslations.bio}}
                        </label>
                        <textarea id="bio" 
                                  name="bio" 
                                  class="form-textarea"
                                  rows="4"
                                  placeholder="{{creatorTranslations.bioPlaceholder}}"
                                  maxlength="500"></textarea>
                        <span class="form-hint char-count"><span id="bioCount">0</span>/500</span>
                    </div>

                    <!-- Category -->
                    <div class="form-group">
                        <label for="category" class="form-label">
                            <i class="bi bi-tag me-1"></i>
                            {{creatorTranslations.category}}
                            <span class="required">*</span>
                        </label>
                        <select id="category" name="category" class="form-select" required>
                            {{#each categories}}
                            <option value="{{this.id}}">{{this.label}}</option>
                            {{/each}}
                        </select>
                    </div>

                    <!-- Tags -->
                    <div class="form-group">
                        <label for="tags" class="form-label">
                            <i class="bi bi-tags me-1"></i>
                            {{creatorTranslations.tags}}
                        </label>
                        <input type="text" 
                               id="tags" 
                               name="tags" 
                               class="form-input"
                               placeholder="{{creatorTranslations.tagsPlaceholder}}">
                        <span class="form-hint">{{creatorTranslations.tagsHint}}</span>
                        <div id="tagsPreview" class="tags-preview"></div>
                    </div>

                    <!-- Social Links Section -->
                    <div class="form-section">
                        <h3 class="section-subtitle">
                            <i class="bi bi-link-45deg me-2"></i>
                            {{creatorTranslations.socialLinks}}
                        </h3>
                        <p class="section-hint">{{creatorTranslations.socialLinksHint}}</p>

                        <div class="social-links-grid">
                            <div class="form-group social-input">
                                <label for="instagram" class="form-label">
                                    <i class="bi bi-instagram"></i>
                                </label>
                                <input type="url" 
                                       id="instagram" 
                                       name="instagram" 
                                       class="form-input"
                                       placeholder="https://instagram.com/username">
                            </div>

                            <div class="form-group social-input">
                                <label for="twitter" class="form-label">
                                    <i class="bi bi-twitter-x"></i>
                                </label>
                                <input type="url" 
                                       id="twitter" 
                                       name="twitter" 
                                       class="form-input"
                                       placeholder="https://twitter.com/username">
                            </div>

                            <div class="form-group social-input">
                                <label for="youtube" class="form-label">
                                    <i class="bi bi-youtube"></i>
                                </label>
                                <input type="url" 
                                       id="youtube" 
                                       name="youtube" 
                                       class="form-input"
                                       placeholder="https://youtube.com/@channel">
                            </div>

                            <div class="form-group social-input">
                                <label for="website" class="form-label">
                                    <i class="bi bi-globe"></i>
                                </label>
                                <input type="url" 
                                       id="website" 
                                       name="website" 
                                       class="form-input"
                                       placeholder="https://yourwebsite.com">
                            </div>
                        </div>
                    </div>

                    <!-- Terms Agreement -->
                    <div class="form-group checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="agreeTerms" name="agreeTerms" required>
                            <span class="checkmark"></span>
                            {{{creatorTranslations.agreeTerms}}}
                        </label>
                    </div>

                    <!-- Submit Button -->
                    <div class="form-actions">
                        <a href="/creators" class="btn-secondary">
                            <i class="bi bi-arrow-left me-2"></i>
                            {{creatorTranslations.cancel}}
                        </a>
                        <button type="submit" class="btn-primary" id="submitBtn">
                            <span class="btn-text">
                                <i class="bi bi-rocket me-2"></i>
                                {{creatorTranslations.submitApplication}}
                            </span>
                            <span class="btn-loading" style="display: none;">
                                <i class="bi bi-hourglass-split me-2"></i>
                                {{creatorTranslations.submitting}}
                            </span>
                        </button>
                    </div>
                </form>
            </div>
        </section>        {{/if}}
        <!-- FAQ Section -->
        <section class="faq-section">
            <h2 class="faq-title">
                <i class="bi bi-question-circle me-2"></i>
                {{creatorTranslations.faqTitle}}
            </h2>
            <div class="faq-list">
                <div class="faq-item">
                    <button class="faq-question" onclick="toggleFaq(this)">
                        <span>{{creatorTranslations.faqQuestion1}}</span>
                        <i class="bi bi-chevron-down"></i>
                    </button>
                    <div class="faq-answer">
                        <p>{{creatorTranslations.faqAnswer1}}</p>
                    </div>
                </div>
                <div class="faq-item">
                    <button class="faq-question" onclick="toggleFaq(this)">
                        <span>{{creatorTranslations.faqQuestion2}}</span>
                        <i class="bi bi-chevron-down"></i>
                    </button>
                    <div class="faq-answer">
                        <p>{{creatorTranslations.faqAnswer2}}</p>
                    </div>
                </div>
                <div class="faq-item">
                    <button class="faq-question" onclick="toggleFaq(this)">
                        <span>{{creatorTranslations.faqQuestion3}}</span>
                        <i class="bi bi-chevron-down"></i>
                    </button>
                    <div class="faq-answer">
                        <p>{{creatorTranslations.faqAnswer3}}</p>
                    </div>
                </div>
                <div class="faq-item">
                    <button class="faq-question" onclick="toggleFaq(this)">
                        <span>{{creatorTranslations.faqQuestion4}}</span>
                        <i class="bi bi-chevron-down"></i>
                    </button>
                    <div class="faq-answer">
                        <p>{{creatorTranslations.faqAnswer4}}</p>
                    </div>
                </div>
            </div>
        </section>
    </div>

    {{> dashboard-footer}}

    <script>
        // Bio character counter
        document.getElementById('bio').addEventListener('input', function() {
            document.getElementById('bioCount').textContent = this.value.length;
        });

        // Tags preview
        document.getElementById('tags').addEventListener('input', function() {
            const tagsPreview = document.getElementById('tagsPreview');
            const tags = this.value.split(',').map(t => t.trim()).filter(t => t.length > 0).slice(0, 5);
            
            if (tags.length > 0) {
                tagsPreview.innerHTML = tags.map(tag => `<span class="tag-preview">${tag}</span>`).join('');
            } else {
                tagsPreview.innerHTML = '';
            }
        });

        // FAQ toggle
        function toggleFaq(element) {
            const faqItem = element.closest('.faq-item');
            faqItem.classList.toggle('active');
        }

        // Form submission
        document.getElementById('creatorApplicationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const btnText = submitBtn.querySelector('.btn-text');
            const btnLoading = submitBtn.querySelector('.btn-loading');
            
            // Show loading state
            btnText.style.display = 'none';
            btnLoading.style.display = 'inline-flex';
            submitBtn.disabled = true;

            try {
                const formData = {
                    displayName: document.getElementById('displayName').value.trim(),
                    bio: document.getElementById('bio').value.trim(),
                    category: document.getElementById('category').value,
                    tags: document.getElementById('tags').value.split(',').map(t => t.trim()).filter(t => t.length > 0).slice(0, 5),
                    instagram: document.getElementById('instagram').value.trim(),
                    twitter: document.getElementById('twitter').value.trim(),
                    youtube: document.getElementById('youtube').value.trim(),
                    website: document.getElementById('website').value.trim()
                };

                const response = await fetch('/api/creators/apply', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (result.success) {
                    // Show success message
                    if (typeof Swal !== 'undefined') {
                        await Swal.fire({
                            icon: 'success',
                            title: window.creatorTranslations?.successTitle || 'Welcome, Creator!',
                            text: window.creatorTranslations?.successMessage || 'Your creator profile has been set up. Start sharing your amazing content!',
                            confirmButtonColor: '#8240FF'
                        });
                    } else {
                        alert(window.creatorTranslations?.successMessage || 'Your creator profile has been set up successfully!');
                    }
                    // Redirect to profile
                    window.location.href = '/user/{{user._id}}';
                } else {
                    throw new Error(result.error || 'Application failed');
                }
            } catch (error) {
                console.error('Application error:', error);
                if (typeof Swal !== 'undefined') {
                    Swal.fire({
                        icon: 'error',
                        title: window.creatorTranslations?.errorTitle || 'Oops!',
                        text: error.message || window.creatorTranslations?.errorMessage || 'Something went wrong. Please try again.',
                        confirmButtonColor: '#8240FF'
                    });
                } else {
                    alert(error.message || window.creatorTranslations?.errorMessage || 'Something went wrong. Please try again.');
                }
            } finally {
                // Reset button state
                btnText.style.display = 'inline-flex';
                btnLoading.style.display = 'none';
                submitBtn.disabled = false;
            }
        });
    </script>
</body>
</html>
